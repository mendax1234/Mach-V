
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A high-performance RISC-V processor on FPGA. Bridging the gap between beginner-friendly education and advanced hardware architecture.">
      
      
        <meta name="author" content="Wenbo (Daniel) Zhu">
      
      
        <link rel="canonical" href="https://mendax1234.github.io/Mach-V/print_page/">
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Print Site - Mach-V Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../css/timeago.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("/Mach-V/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#index" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mach-V Docs" class="md-header__button md-logo" aria-label="Mach-V Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mach-V Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mendax1234/Mach-V" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mendax1234/Mach-V
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../uarch/" class="md-tabs__link">
          
  
  
    
  
  Microarchitecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../sim/" class="md-tabs__link">
          
  
  
    
  
  Simulation

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../sw/" class="md-tabs__link">
          
  
  
    
  
  Software

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mach-V Docs" class="md-nav__button md-logo" aria-label="Mach-V Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Mach-V Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mendax1234/Mach-V" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mendax1234/Mach-V
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../uarch/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Microarchitecture
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Microarchitecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uarch/clock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clock Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uarch/pc-unit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Program Counter Unit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uarch/alu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Arithmetic & Logic Unit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uarch/mul-div-unit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiply & Divide Unit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uarch/lsu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load & Store Unit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uarch/hazard-unit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hazard Handling Unit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../sim/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Simulation
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Simulation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/benchmark_tb/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41s-1.03.39-1.42.01A9.97 9.97 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13"/></svg>
  
  <span class="md-ellipsis">
    
  
    Benchmark Testbench
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/uart_tb/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 19V7H4v12zm0-16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-7 14v-2h5v2zm-3.42-4L5.57 9H8.4l3.3 3.3c.39.39.39 1.03 0 1.42L8.42 17H5.59z"/></svg>
  
  <span class="md-ellipsis">
    
  
    UART Testbench
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../sw/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Software
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sw/benchmark/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41s-1.03.39-1.42.01A9.97 9.97 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13"/></svg>
  
  <span class="md-ellipsis">
    
  
    Benchmark
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sw/uart_calculator/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 2v4h10V4zm0 6v2h2v-2zm4 0v2h2v-2zm4 0v2h2v-2zm-8 4v2h2v-2zm4 0v2h2v-2zm4 0v2h2v-2zm-8 4v2h2v-2zm4 0v2h2v-2zm4 0v2h2v-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    UART Calculator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sw/resources/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21.5c-1.35-.85-3.8-1.5-5.5-1.5-1.65 0-3.35.3-4.75 1.05-.1.05-.15.05-.25.05-.25 0-.5-.25-.5-.5V6c.6-.45 1.25-.75 2-1 1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5.75.25 1.4.55 2 1v14.6c0 .25-.25.5-.5.5-.1 0-.15 0-.25-.05-1.4-.75-3.1-1.05-4.75-1.05-1.7 0-4.15.65-5.5 1.5M12 8v11.5c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5V7c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5m1 3.5c1.11-.68 2.6-1 4.5-1 .91 0 1.76.09 2.5.28V9.23c-.87-.15-1.71-.23-2.5-.23q-2.655 0-4.5.84zm4.5.17c-1.71 0-3.21.26-4.5.79v1.69c1.11-.65 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24v-1.5c-.87-.16-1.71-.23-2.5-.23m2.5 2.9c-.87-.16-1.71-.24-2.5-.24-1.83 0-3.33.27-4.5.8v1.69c1.11-.66 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../sw/changelog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Changelog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sw/changelog/conventions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conventions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 Home
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 Microarchitecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Microarchitecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uarch" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Microarchitecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uarch-clock" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Clock Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uarch-pc-unit" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Program Counter Unit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uarch-alu" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 Arithmetic & Logic Unit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uarch-mul-div-unit" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 Multiply & Divide Unit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uarch-lsu" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.6 Load & Store Unit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uarch-hazard-unit" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.7 Hazard Handling Unit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3 Simulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sim" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Simulation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sim-benchmark_tb" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Benchmark Testbench
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sim-uart_tb" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 UART Testbench
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4 Software
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sw" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Software Development Guide
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sw-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Benchmark
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sw-uart_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 UART Calculator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sw-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-4-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.5 Changelog
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.5 Changelog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sw-changelog" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.5.1 Changelog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sw-changelog-conventions" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.5.2 Conventions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


              
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index" heading-number="1"><p>Welcome to the <strong>Mach-V Documentation</strong>!</p></section>
                    <section class='print-page md-section' id='section-2' heading-number='2'>
                        <h1>Microarchitecture<a class='headerlink' href='#section-2' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="uarch" heading-number="2.1"><h1 id="uarch-microarchitecture">Microarchitecture<a class="headerlink" href="#uarch-microarchitecture" title="Permanent link">&para;</a></h1>
<h2 id="uarch-performance-benchmark">Performance Benchmark<a class="headerlink" href="#uarch-performance-benchmark" title="Permanent link">&para;</a></h2>
<p>Here is the performance scaling of the Mach-V core running the CoreMark benchmark.</p>
<p><img alt="CoreMark Performance" src="../assets/images/mach-v-coremark-performance-light.png#only-light" />
<img alt="CoreMark Performance" src="../assets/images/mach-v-coremark-performance-dark.png#only-dark" /></p>
<h2 id="uarch-microarchitecture-overview">Microarchitecture Overview<a class="headerlink" href="#uarch-microarchitecture-overview" title="Permanent link">&para;</a></h2>
<p>The microarchitecture of Mach-V has currently evolved through two distinct iterations:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="uarch-mach-v-version-1" name="uarch-__tabbed_1" type="radio" /><input id="uarch-mach-v-version-2" name="uarch-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="uarch-mach-v-version-1">Mach-V Version 1</label><label for="uarch-mach-v-version-2">Mach-V Version 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<figure>
<p><img alt="Mach-V V1 Microarchitecture" src="../assets/images/Mach-V-V1.svg" /></p>
<figcaption>
<p>Mach-V Microarchitecture - Version 1</p>
</figcaption>
</figure>
<p>Mach-V Version 1 serves as the baseline implementation, featuring a classic RISC-V scalar architecture:</p>
<ol>
<li><strong>Classic 5-Stage Pipeline:</strong> Implements the standard Fetch, Decode, Execute, Memory, and Writeback stages for balanced throughput.</li>
<li><strong>Comprehensive Hazard Management:</strong> Dedicated hardware for data forwarding and hazard detection resolves data and control hazards automatically.</li>
<li><strong>Scalar In-Order Execution:</strong> Issues, executes, and commits instructions sequentially (single-issue) to ensure deterministic behavior and architectural simplicity.</li>
</ol>
</div>
<div class="tabbed-block">
<figure>
<p><img alt="Mach-V V2 Microarchitecture" src="../assets/images/Mach-V-V2.svg" /></p>
<figcaption>
<p>Mach-V Microarchitecture - Version 2</p>
</figcaption>
</figure>
<p>Mach-V Version 2 focuses on timing optimization and hardware acceleration, introducing the following enhancements:</p>
<ol>
<li><strong>Enhanced Clock Frequency:</strong> Integrated Clock Wizard boosts the operating frequency to <strong>115 MHz</strong> (surpassing the 100 MHz baseline).</li>
<li><strong>Critical Path Optimization:</strong> PC logic is relocated from the Execute (EXE) stage to the Memory (MEM) stage to relax timing constraints.</li>
<li><strong>Hardware-Accelerated Arithmetic:</strong> Replaces native design with optimized AMD/Xilinx IP cores for high-performance integer multiplication and division.</li>
</ol>
</div>
</div>
</div></section><section class="print-page" id="uarch-clock" heading-number="2.2"><h1 id="uarch-clock-clock-architecture">Clock Architecture<a class="headerlink" href="#uarch-clock-clock-architecture" title="Permanent link">&para;</a></h1>
<p>Consistent with the synchronous design conventions established in NUS CG3207, the Mach-V processor operates within a single clock domain. All registers and sequential logic are driven by a single global clock signal to simplify timing analysis.</p>
<h2 id="uarch-clock-clock-frequency-scaling">Clock Frequency Scaling<a class="headerlink" href="#uarch-clock-clock-frequency-scaling" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-2.0">2.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-plugin" title="External IP / Plugin"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5.5L18.5 3H17v6a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V3zm7 1v5h3V4zm-5 8h10a1 1 0 0 1 1 1v6H6v-6a1 1 0 0 1 1-1"/></svg></span></a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p>The default clock is only 100MHz maximum. To improve the performance of Mach-V, I utilize the AMD Clocking Wizard IP core to synthesize a higher frequency clock from this base input.</p>
<h3 id="uarch-clock-generate-the-ip-core">Generate the IP Core<a class="headerlink" href="#uarch-clock-generate-the-ip-core" title="Permanent link">&para;</a></h3>
<p>To use the IP in Vivado, click the "IP Catalog" on the left flow navigator. Then, search for "clocking wizard". Click the only option available. And then configure the IP to use the following settings:</p>
<ol>
<li>In the "Clocking Options" tab:<ul>
<li>Make sure the primary input clock is <code>clk_in1</code> with a frequency of <code>100 MHz</code>.</li>
<li>Make sure the primary input clock source is "Single ended clock capable pin".</li>
</ul>
</li>
<li>In the "Output Clocks" tab:<ul>
<li>Click the <code>clk_out1</code> and set the frequency that you want to achieve.</li>
<li>Make sure the "Reset Type" is set to "Active High".</li>
<li>Make sure the "locked" option is enabled under the "Enable Optional Inputs".</li>
</ul>
</li>
</ol>
<h3 id="uarch-clock-use-the-ip-core">Use the IP Core<a class="headerlink" href="#uarch-clock-use-the-ip-core" title="Permanent link">&para;</a></h3>
<p>The clock generation logic must be instantiated in the top-level entity (TOP_Nexys.vhd).</p>
<hr />
<h4 id="uarch-clock-component-declaration">Component Declaration<a class="headerlink" href="#uarch-clock-component-declaration" title="Permanent link">&para;</a></h4>
<p>Add the component declaration before the architecture begin keyword:</p>
<div class="language-vhdl highlight"><span class="filename">Top_Nexys.vhd</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#uarch-clock-__codelineno-0-1"></a><span class="c1">----------------------------------------------------------------------------</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#uarch-clock-__codelineno-0-2"></a><span class="c1">-- Component: Clocking Wizard</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#uarch-clock-__codelineno-0-3"></a><span class="c1">----------------------------------------------------------------------------</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#uarch-clock-__codelineno-0-4"></a><span class="k">component</span><span class="w"> </span><span class="nc">clk_wiz_0</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#uarch-clock-__codelineno-0-5"></a><span class="k">port</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#uarch-clock-__codelineno-0-6"></a><span class="w">    </span><span class="c1">-- Clock in ports</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#uarch-clock-__codelineno-0-7"></a><span class="w">    </span><span class="n">clk_in1</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="p">;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#uarch-clock-__codelineno-0-8"></a><span class="w">    </span><span class="c1">-- Clock out ports</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#uarch-clock-__codelineno-0-9"></a><span class="w">    </span><span class="n">clk_out1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#uarch-clock-__codelineno-0-10"></a><span class="w">    </span><span class="c1">-- Status and control signals</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#uarch-clock-__codelineno-0-11"></a><span class="w">    </span><span class="n">reset</span><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#uarch-clock-__codelineno-0-12"></a><span class="w">    </span><span class="n">locked</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#uarch-clock-__codelineno-0-13"></a><span class="p">);</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#uarch-clock-__codelineno-0-14"></a><span class="k">end</span><span class="w"> </span><span class="k">component</span><span class="p">;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#uarch-clock-__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#uarch-clock-__codelineno-0-16"></a><span class="c1">----------------------------------------------------------------------------</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#uarch-clock-__codelineno-0-17"></a><span class="c1">-- Signals: Clock &amp; Reset Management</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#uarch-clock-__codelineno-0-18"></a><span class="c1">----------------------------------------------------------------------------</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#uarch-clock-__codelineno-0-19"></a><span class="k">signal</span><span class="w"> </span><span class="n">clk_sys</span><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span><span class="w"> </span><span class="c1">-- The synthesized high-speed system clock</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#uarch-clock-__codelineno-0-20"></a><span class="k">signal</span><span class="w"> </span><span class="n">clk_locked</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span><span class="w"> </span><span class="c1">-- High (&#39;1&#39;) when the clock is stable</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#uarch-clock-__codelineno-0-21"></a><span class="k">signal</span><span class="w"> </span><span class="n">sys_reset</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Combined effective system reset</span>
</span></code></pre></div>
<hr />
<h4 id="uarch-clock-instantiation">Instantiation<a class="headerlink" href="#uarch-clock-instantiation" title="Permanent link">&para;</a></h4>
<p>Instantiate the IP core within the architecture body, mapping the board's raw clock to the input:</p>
<div class="language-vhdl highlight"><span class="filename">Top_Nexys.vhd</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#uarch-clock-__codelineno-1-1"></a><span class="c1">----------------------------------------------------------------</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#uarch-clock-__codelineno-1-2"></a><span class="c1">-- Instance: Clocking Wizard</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#uarch-clock-__codelineno-1-3"></a><span class="c1">----------------------------------------------------------------</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#uarch-clock-__codelineno-1-4"></a><span class="n">clk_wiz_inst</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">clk_wiz_0</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#uarch-clock-__codelineno-1-5"></a><span class="k">port</span><span class="w"> </span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#uarch-clock-__codelineno-1-6"></a><span class="w">    </span><span class="n">clk_in1</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CLK_undiv</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Raw 100MHz from physical board pin</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#uarch-clock-__codelineno-1-7"></a><span class="w">    </span><span class="n">clk_out1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">clk_sys</span><span class="p">,</span><span class="w">    </span><span class="c1">-- Synthesized Fast Clock</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#uarch-clock-__codelineno-1-8"></a><span class="w">    </span><span class="n">reset</span><span class="w">    </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RESET</span><span class="p">,</span><span class="w">      </span><span class="c1">-- Raw button reset (Active High)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#uarch-clock-__codelineno-1-9"></a><span class="w">    </span><span class="n">locked</span><span class="w">   </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">clk_locked</span><span class="w">  </span><span class="c1">-- Status signal</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#uarch-clock-__codelineno-1-10"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h4 id="uarch-clock-system-reset-logic">System Reset Logic<a class="headerlink" href="#uarch-clock-system-reset-logic" title="Permanent link">&para;</a></h4>
<p>It is critical to hold the processor in reset until the clock signal is stable. The <code>locked</code> signal from the Clocking Wizard indicates when the output frequency is stable.</p>
<p>I generate a <code>RESET_EFF</code> (Effective Reset) signal that is asserted (High) if either:</p>
<ol>
<li>The physical reset button is pressed (<code>RESET_INT</code> / <code>RESET_EXT</code>).</li>
<li>The clock is not yet locked (not <code>clk_locked</code>).</li>
</ol>
<div class="language-vhdl highlight"><span class="filename">Top_Nexys.vhd</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#uarch-clock-__codelineno-2-1"></a><span class="c1">-- Original Logic (Raw Button only)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#uarch-clock-__codelineno-2-2"></a><span class="c1">-- RESET_EFF &lt;= RESET_INT or RESET_EXT;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#uarch-clock-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#uarch-clock-__codelineno-2-4"></a><span class="c1">-- New Logic (Button + Clock Stability Guard)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#uarch-clock-__codelineno-2-5"></a><span class="n">RESET_EFF</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">RESET_INT</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">RESET_EXT</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="p">(</span><span class="k">not</span><span class="w"> </span><span class="n">clk_locked</span><span class="p">);</span>
</span></code></pre></div>
<hr />
<h4 id="uarch-clock-frequency-constant-update">Frequency Constant Update<a class="headerlink" href="#uarch-clock-frequency-constant-update" title="Permanent link">&para;</a></h4>
<p>Finally, ensure the software-visible frequency constant matches the new hardware configuration. This is often used for UART baud rate calculations or timer peripherals.</p>
<div class="language-vhdl highlight"><span class="filename">Top_Nexys.vhd</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#uarch-clock-__codelineno-3-1"></a><span class="c1">-- Update this value to match the Clocking Wizard output</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#uarch-clock-__codelineno-3-2"></a><span class="k">constant</span><span class="w"> </span><span class="n">CLOCK_FREQUENCY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">positive</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">115000000</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>CLOCK_FREQUENCY</code> constant is not automatically linked to the IP Core settings. If you reconfigure the Clocking Wizard to a different frequency (e.g., changing from 120MHz to 150MHz), you <strong>must manually update</strong> the <code>CLOCK_FREQUENCY</code> constant in <code>TOP_Nexys.vhd</code> to ensure correct timing for peripherals like UART.</p>
</div></section><section class="print-page" id="uarch-pc-unit" heading-number="2.3"><h1 id="uarch-pc-unit-pc-logic">PC Logic<a class="headerlink" href="#uarch-pc-unit-pc-logic" title="Permanent link">&para;</a></h1>
<p>This section details the implementation of the Program Counter (PC) logic, covering <code>PC_Logic.v</code>, <code>ProgramCounter.v</code>, and the relevant multiplexing logic for the PC adder within <code>RV.v</code>.</p>
<h2 id="uarch-pc-unit-moving-pc-logic-to-the-mem-stage">Moving PC Logic to the Mem Stage<a class="headerlink" href="#uarch-pc-unit-moving-pc-logic-to-the-mem-stage" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-2.0">2.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p>In Mach-V Version 2, the PC logic was relocated from the Execute (Exe) stage to the Memory (Mem) stage. This architectural change implies that branch and jump instructions are now committed in the Mem stage. This optimization significantly improved timing performance, allowing Mach-V to achieve a clock frequency of 115 MHz (utilizing the Clocking Wizard IP).</p>
<p>To support this transition, the input logic for the PC Adder was redesigned as follows:</p>
<ol>
<li><strong><code>PC_Base</code> Selection</strong>: The base address multiplexer now accepts three new inputs:<ul>
<li><code>PCF</code>: For sequential execution (Branch Not Taken).</li>
<li><code>PCM</code>: For conditional branches (Branch Taken).</li>
<li><code>RD1M</code>: For jump instructions. Note that <code>RD1M</code> is derived from <code>RD1E_Forwarded</code> and latched into the Mem stage pipeline register.</li>
</ul>
</li>
<li><strong><code>PC_Offset</code> Selection</strong>: The offset multiplexer now selects between <code>4</code> (sequential) or <code>ExtImmM</code> (branch/jump targets).</li>
</ol>
<p>Following the PC adder updates, the <code>PC_Logic</code> module itself was simplified. The control signals <code>PCSE</code> and <code>ALUFlagsE</code> are propagated through the pipeline registers to become <code>PCSM</code> and <code>ALUFlagsM</code>. These are then fed into the PC Logic unit in the Mem stage, generating the final branch decision signal, <code>PCSrcM</code>.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The updated microarchitecture diagram illustrating the move of PC Logic to the Mem stage can be found <a href="#uarch-microarchitecture-overview">in Mach-V Version 2's microarchitecture diagram</a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Simply delaying the control signals is insufficient for this architectural change. The <a href="#uarch-hazard-unit">Hazard Unit</a> must also be updated to handle the new branch resolution timing correctly.</p>
</div></section><section class="print-page" id="uarch-alu" heading-number="2.4"><h1 id="uarch-alu-arithmetic-logic-unit-alu">Arithmetic &amp; Logic Unit (ALU)<a class="headerlink" href="#uarch-alu-arithmetic-logic-unit-alu" title="Permanent link">&para;</a></h1>
<p>The Mach-V ALU is a streamlined execution unit derived from the reference design used in <a href="https://github.com/NUS-CG3207/labs/blob/main/docs/code_templates/Asst_02/ALU.v">NUS CG3207</a>. It implements standard RISC-V integer arithmetic and logical operations, utilizing a <a href="https://github.com/NUS-CG3207/labs/blob/main/docs/code_templates/Asst_02/Shifter.v">barrel shifter</a> designed by NUS CG3207 teaching team for efficient single-cycle shift operations.</p>
<h2 id="uarch-alu-zero-flag-optimization">Zero Flag Optimization<a class="headerlink" href="#uarch-alu-zero-flag-optimization" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-2.0">2.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p>While the base architecture is inherited, a critical timing optimization was introduced to the <strong>Zero (Z) flag generation</strong>. In the <a href="https://github.com/NUS-CG3207/labs/blob/main/docs/code_templates/Asst_02/ALU.v#L79">reference design</a>, the Z flag is typically derived from the final <code>ALUResult</code> (after the result multiplexer). This creates a long logic chain: <code>Adder -&gt; Result Mux -&gt; Zero Check</code>.</p>
<p>To reduce the critical path, Mach-V computes the Z flag directly from the 33-bit adder output (<code>Sum</code>) <strong>in parallel</strong> with the result multiplexer. This decouples the flag generation from the multiplexing logic, significantly reducing propagation delay.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#uarch-alu-__codelineno-0-1"></a><span class="c1">// Critical Path Optimization: </span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#uarch-alu-__codelineno-0-2"></a><span class="c1">// Calculate Zero flag from the intermediate Sum rather than the final ALUResult</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#uarch-alu-__codelineno-0-3"></a><span class="k">assign</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Sum</span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">32</span><span class="mb">&#39;b0</span><span class="p">);</span>
</span></code></pre></div>
<div class="admonition failure">
<p class="admonition-title">Timing Closure</p>
<p>This optimization is mandatory for Mach-V to achieve timing closure at 115 MHz. Reverting to the standard post-mux Zero generation will cause setup time violations on the Vivado tool.</p>
</div></section><section class="print-page" id="uarch-mul-div-unit" heading-number="2.5"><h1 id="uarch-mul-div-unit-multiply-divide-unit">Multiply &amp; Divide Unit<a class="headerlink" href="#uarch-mul-div-unit-multiply-divide-unit" title="Permanent link">&para;</a></h1>
<p>In this version of the Mach-V processor, the multiply and divide unit is incorporated into one file called <code>MCycle.v</code>. The whole idea of the <code>MCycle</code> module is that, while it is doing the computation, the <code>Busy</code> signal (output) will be triggered high and this signal will be used to stall the other relevant pipeline registers so that no new instructions are fetched until the multiplication/division is complete.</p>
<p>This module is implemented using the mealy state machine.</p>
<h2 id="uarch-mul-div-unit-state-machine-control">State Machine Control<a class="headerlink" href="#uarch-mul-div-unit-state-machine-control" title="Permanent link">&para;</a></h2>
<h2 id="uarch-mul-div-unit-implementation-details">Implementation Details<a class="headerlink" href="#uarch-mul-div-unit-implementation-details" title="Permanent link">&para;</a></h2>
<p>I have tried two implementations for the <code>MCycle</code> module:</p>
<div class="grid cards">
<ul>
<li>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 4h10c1.11 0 2 .89 2 2v2h-3.41L16 10.59v4l-2 2V20h-4v-3.41l-2-2V9.41l2-2zm8 7.41V14h4v-4h-2.59zM6.59 8 8 6.59V4H4c-1.11 0-2 .89-2 2v2zM6 14v-4H2v4zm2 3.41L6.59 16H2v2c0 1.11.89 2 2 2h4zM17.41 16 16 17.41V20h4c1.11 0 2-.89 2-2v-2z"/></svg></span> <strong>Native Design</strong></p>
<hr />
<p>Implement the multiply and divide unit by "hand-typped" Verilog code.</p>
<p><a href="#uarch-mul-div-unit-native-design"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> View Documentation</a></p>
</li>
<li>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.123 24q-.303 0-.603-.017a.5.5 0 0 1-.043-.287.7.7 0 0 0-.022-.263h-2.23a1.2 1.2 0 0 1-.785.39.7.7 0 0 1-.507-.228.915.915 0 0 1-.065-1.1.7.7 0 0 1 .557-.266 1.22 1.22 0 0 1 .703.267h2.328a2 2 0 0 0 0-.614H10.26a1.14 1.14 0 0 1-.55-.13 22 22 0 0 0-1.487-.808 1.4 1.4 0 0 0-.71-.194 7 7 0 0 1-.476.015q-.236-.001-.464-.007a19 19 0 0 0-.45-.008 1.35 1.35 0 0 1-.814.37.68.68 0 0 1-.512-.24.76.76 0 0 1 0-1.067.72.72 0 0 1 .537-.272 1.3 1.3 0 0 1 .756.337h1.681a1.14 1.14 0 0 1 .55.129c.14.082.293.162.441.239a6 6 0 0 1 .754.44 1.95 1.95 0 0 0 1.116.33 3 3 0 0 0 .178-.007 2 2 0 0 1 .219-.014q.101 0 .208.007c.08.004.161.007.251.007v-1.034h-1.164a1.27 1.27 0 0 1-.71.3.84.84 0 0 1-.615-.332c-.37-.404-.134-.803.13-1.067a.56.56 0 0 1 .353-.125 1.35 1.35 0 0 1 .842.448h1.1v-.905a.4.4 0 0 0-.178-.04q-.04 0-.083.004-.044.003-.095.004H4.959a.84.84 0 0 1-.743-.356c-.172-.228-.37-.459-.545-.663l-.07-.08c-.743-.065-.97-.285-.937-.905a.75.75 0 0 1 .84-.679c.492 0 .711.33.711 1.067q.09.105.183.22c.136.164.276.335.432.491h6.658a5.5 5.5 0 0 0 0-1.034H6.64a1.32 1.32 0 0 1-.795.37.66.66 0 0 1-.498-.24.746.746 0 0 1 0-1.1.7.7 0 0 1 .508-.268 1.17 1.17 0 0 1 .72.365h4.88v-1.002H3.215q-.234.259-.502.535c-.158.166-.321.337-.5.531a.84.84 0 0 1-.792.752 1 1 0 0 1-.114-.008.846.846 0 0 1-.646-1.002c.059-.383.372-.602.86-.602a2 2 0 0 1 .271.02c.177-.206.444-.508.711-.776a.96.96 0 0 1 .776-.323h8.177v-1.099H1.63a1.23 1.23 0 0 1-.744.344.68.68 0 0 1-.55-.312.85.85 0 0 1 .098-1.13.75.75 0 0 1 .479-.195 1.15 1.15 0 0 1 .814.485h3.2l-.102-.097c-.56-.528-1.138-1.075-1.838-1.713a.755.755 0 0 1-.776-.808c0-.514.22-.743.711-.743.662 0 .84.212.873 1.034.248.238.492.469.75.713.543.513 1.102 1.042 1.674 1.614h5.236v-.743H9.161a1.28 1.28 0 0 1-.705.263.75.75 0 0 1-.588-.296.81.81 0 0 1 .129-1.098.64.64 0 0 1 .437-.168 1.28 1.28 0 0 1 .824.394h2.198v-.84q-.342-.001-.671-.008h-.007a39 39 0 0 0-.656-.007c-.248 0-.467.005-.67.014a1 1 0 0 1-.115.005 1.23 1.23 0 0 1-.855-.36l-.6-.507-.012-.01-.008-.007A261 261 0 0 0 6.64 7.272H3.052a1.24 1.24 0 0 1-.72.29.73.73 0 0 1-.573-.29.776.776 0 0 1 .097-1.099.7.7 0 0 1 .474-.223 1.36 1.36 0 0 1 .819.45h3.135a1.6 1.6 0 0 1 1.164.452c.373.351.795.69 1.203 1.019h.001c.19.153.388.311.573.466h2.198V7.271c-.138 0-.282-.004-.42-.007H11a18 18 0 0 0-.44-.008q-.24 0-.428.015a1 1 0 0 1-.115.005 1.34 1.34 0 0 1-.856-.327 11 11 0 0 0-.305-.24c-.103-.08-.212-.162-.31-.245-.8-.064-1.098-.29-1.066-.808a.776.776 0 0 1 .776-.743c.497 0 .775.302.808.872.129.097.258.204.388.307l.001.002c.127.103.259.21.388.306h1.584V5.14h-.55a1.35 1.35 0 0 1-.765.36.69.69 0 0 1-.528-.296.8.8 0 0 1 .033-1.1.7.7 0 0 1 .5-.214 1.1 1.1 0 0 1 .759.376h.517a.5.5 0 0 0 .043-.346 1 1 0 0 1-.01-.138v-.517a3 3 0 0 1-.292.012 9 9 0 0 1-.355-.01h-.007a8 8 0 0 0-.364-.01 1.96 1.96 0 0 0-1.018.234 11 11 0 0 1-1.115.582H8.27c-.153.073-.312.148-.466.224a.9.9 0 0 1-.42.065H5.22a1.1 1.1 0 0 1-.696.328.78.78 0 0 1-.598-.327.72.72 0 0 1-.181-.545.85.85 0 0 1 .31-.586.74.74 0 0 1 .473-.197 1.07 1.07 0 0 1 .755.456h2.101a.6.6 0 0 0 .223-.053 1 1 0 0 1 .133-.044q.197-.099.39-.19a10 10 0 0 0 .935-.489 2.56 2.56 0 0 1 1.353-.362q.097 0 .198.006a2 2 0 0 0 .258.014q.127 0 .26-.006h.001q.138-.007.286-.008a2.1 2.1 0 0 0 .037-.59q-.004-.105-.004-.218H9.416a1.46 1.46 0 0 1-.766.332.68.68 0 0 1-.526-.3.83.83 0 0 1 .065-1.098.72.72 0 0 1 .487-.205 1.24 1.24 0 0 1 .776.366h2.004q.002-.133.014-.276c.009-.114.018-.231.018-.37h.126c4.196 0 7.492 1.642 9.797 4.88a12.23 12.23 0 0 1 2.408 6.457c.12 2.203-.44 4.457-1.665 6.698a11.4 11.4 0 0 1-4.433 4.477A11.5 11.5 0 0 1 12.123 24m.367-5.577v4.46a1.6 1.6 0 0 0 .27.022 3.5 3.5 0 0 0 .491-.045c.11-.015.22-.033.337-.041a15 15 0 0 0 2.392-4.396zm4.654 0a19 19 0 0 1-1.842 3.944 10.38 10.38 0 0 0 5.3-3.944zm1.035-5.785a20.5 20.5 0 0 1-.68 4.654h3.815a11.2 11.2 0 0 0 1.293-4.654zm-5.69 0v4.622h3.88a18.2 18.2 0 0 0 .678-4.622zm.033-5.786v4.654h4.557a18.7 18.7 0 0 0-.71-4.654zm4.945-.032a21.4 21.4 0 0 1 .711 4.654h4.428a10.9 10.9 0 0 0-1.325-4.654zM15.27 1.778a20 20 0 0 1 1.875 3.943h3.459a10.6 10.6 0 0 0-5.333-3.943zm-2.747-.582c0 1.562 0 3.038.032 4.493h3.459a.12.12 0 0 1-.032-.097 16.2 16.2 0 0 0-2.23-4.105l-.038-.04a.28.28 0 0 0-.189-.122 10 10 0 0 0-1.002-.13"/></svg></span> <strong>Using IP Cores</strong></p>
<hr />
<p>Use Xilinx IP cores to implement the multiply and divide unit.</p>
<p><a href="#uarch-mul-div-unit-amd-ip-design"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> View Documentation</a></p>
</li>
</ul>
</div>
<h3 id="uarch-mul-div-unit-native-design">Native Design<a class="headerlink" href="#uarch-mul-div-unit-native-design" title="Permanent link">&para;</a></h3>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-1.0">1.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-experimental" title="Experimental"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 19a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1c0-.21-.07-.41-.18-.57L13 8.35V4h-2v4.35L5.18 18.43c-.11.16-.18.36-.18.57m1 3a3 3 0 0 1-3-3c0-.6.18-1.16.5-1.63L9 7.81V6a1 1 0 0 1-1-1V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v1a1 1 0 0 1-1 1v1.81l5.5 9.56c.32.47.5 1.03.5 1.63a3 3 0 0 1-3 3zm7-6 1.34-1.34L16.27 18H7.73l2.66-4.61zm-.5-4a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5"/></svg></span></a></span></span></p>
<p>This is a follow-up from <a href="https://nus-cg3207.github.io/labs/asst_manuals/Asst_03/Asst_03/">CG3207 Assignment 3</a>. More specifically, it is my try to finish the first bullet point in the <a href="https://nus-cg3207.github.io/labs/asst_manuals/Asst_03/Asst_03/#task-3-enhancements-5-points">Task 3 of this assignment</a>.</p>
<hr />
<h4 id="uarch-mul-div-unit-multiply-unit">Multiply Unit<a class="headerlink" href="#uarch-mul-div-unit-multiply-unit" title="Permanent link">&para;</a></h4>
<p>For the multiply unit, the idea is to "unroll" the loop. For the 32-bit multiplication, instead of using 32 cycles to compute the result by shifting 1 bit a time, I generate the partial products for every 8 bits of the multiplier in parallel. So, the temporal product here will be <span class="arithmatex">\(32+8=40\)</span> bits wide.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#uarch-mul-div-unit-__codelineno-0-1"></a><span class="k">module</span><span class="w"> </span><span class="n">Multiplier32x8</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#uarch-mul-div-unit-__codelineno-0-2"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w">       </span><span class="c1">// The 32-bit full operand</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#uarch-mul-div-unit-__codelineno-0-3"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w">       </span><span class="c1">// The 8-bit slice</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#uarch-mul-div-unit-__codelineno-0-4"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">Product</span><span class="w">  </span><span class="c1">// Result (32 + 8 = 40 bits max)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#uarch-mul-div-unit-__codelineno-0-5"></a><span class="p">);</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#uarch-mul-div-unit-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#uarch-mul-div-unit-__codelineno-0-7"></a><span class="w">    </span><span class="c1">// // Generate Partial Products (Shift A based on bit position of B)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#uarch-mul-div-unit-__codelineno-0-8"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">8</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#uarch-mul-div-unit-__codelineno-0-9"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">7</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#uarch-mul-div-unit-__codelineno-0-10"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">6</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">2</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#uarch-mul-div-unit-__codelineno-0-11"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">5</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">3</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#uarch-mul-div-unit-__codelineno-0-12"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">4</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#uarch-mul-div-unit-__codelineno-0-13"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">3</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">5</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#uarch-mul-div-unit-__codelineno-0-14"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">2</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">6</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#uarch-mul-div-unit-__codelineno-0-15"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">7</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#uarch-mul-div-unit-__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#uarch-mul-div-unit-__codelineno-0-17"></a><span class="w">    </span><span class="c1">// Sum them up (Tree adder is faster, but this simple chain works also)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#uarch-mul-div-unit-__codelineno-0-18"></a><span class="w">    </span><span class="k">assign</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pp0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp7</span><span class="p">;</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#uarch-mul-div-unit-__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#uarch-mul-div-unit-__codelineno-0-20"></a><span class="k">endmodule</span>
</span></code></pre></div>
<p>In this module, the input <code>A</code> is the full 32-bit multiplicand, while <code>B</code> is an 8-bit slice of the multiplier. The output <code>Product</code> is the 40-bit partial product. For the sliced version of the multiplier, it can be implemented as follows in the state machine control:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#uarch-mul-div-unit-__codelineno-1-1"></a><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">])</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#uarch-mul-div-unit-__codelineno-1-2"></a><span class="w">    </span><span class="mh">2</span><span class="mb">&#39;b00</span><span class="o">:</span><span class="w"> </span><span class="n">current_byte_op2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs_op2</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#uarch-mul-div-unit-__codelineno-1-3"></a><span class="w">    </span><span class="mh">2</span><span class="mb">&#39;b01</span><span class="o">:</span><span class="w"> </span><span class="n">current_byte_op2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs_op2</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">];</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#uarch-mul-div-unit-__codelineno-1-4"></a><span class="w">    </span><span class="mh">2</span><span class="mb">&#39;b10</span><span class="o">:</span><span class="w"> </span><span class="n">current_byte_op2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs_op2</span><span class="p">[</span><span class="mh">23</span><span class="o">:</span><span class="mh">16</span><span class="p">];</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#uarch-mul-div-unit-__codelineno-1-5"></a><span class="w">    </span><span class="mh">2</span><span class="mb">&#39;b11</span><span class="o">:</span><span class="w"> </span><span class="n">current_byte_op2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs_op2</span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">24</span><span class="p">];</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#uarch-mul-div-unit-__codelineno-1-6"></a><span class="k">endcase</span>
</span></code></pre></div>
<p>The final product is then obtained by summing up the 4 partial products with appropriate shifts, which can be implemented as follows:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#uarch-mul-div-unit-__codelineno-2-1"></a><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#uarch-mul-div-unit-__codelineno-2-2"></a><span class="w">    </span><span class="mh">1</span><span class="o">:</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">partial_product_out</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#uarch-mul-div-unit-__codelineno-2-3"></a><span class="w">    </span><span class="mh">2</span><span class="o">:</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">partial_product_out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mh">8</span><span class="p">);</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#uarch-mul-div-unit-__codelineno-2-4"></a><span class="w">    </span><span class="mh">3</span><span class="o">:</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">partial_product_out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mh">16</span><span class="p">);</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#uarch-mul-div-unit-__codelineno-2-5"></a><span class="w">    </span><span class="mh">4</span><span class="o">:</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult_acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">partial_product_out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mh">24</span><span class="p">);</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#uarch-mul-div-unit-__codelineno-2-6"></a><span class="k">endcase</span>
</span></code></pre></div>
<p>And lastly, this module is instantiated in the <code>MCycle</code> module as follows:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#uarch-mul-div-unit-__codelineno-3-1"></a><span class="n">Multiplier32x8</span><span class="w"> </span><span class="n">mul_unit</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#uarch-mul-div-unit-__codelineno-3-2"></a><span class="w">    </span><span class="p">.</span><span class="n">A</span><span class="w">      </span><span class="p">(</span><span class="n">abs_op1</span><span class="p">),</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#uarch-mul-div-unit-__codelineno-3-3"></a><span class="w">    </span><span class="p">.</span><span class="n">B</span><span class="w">      </span><span class="p">(</span><span class="n">current_byte_op2</span><span class="p">),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#uarch-mul-div-unit-__codelineno-3-4"></a><span class="w">    </span><span class="p">.</span><span class="n">Product</span><span class="p">(</span><span class="n">partial_product_out</span><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#uarch-mul-div-unit-__codelineno-3-5"></a><span class="p">);</span>
</span></code></pre></div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>This technique can indeed be implementated using <code>for</code> loop in Verilog as follows:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#uarch-mul-div-unit-__codelineno-4-1"></a><span class="k">module</span><span class="w"> </span><span class="n">Multiplier32x8</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#uarch-mul-div-unit-__codelineno-4-2"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w">       </span><span class="c1">// The 32-bit full operand</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#uarch-mul-div-unit-__codelineno-4-3"></a><span class="w">    </span><span class="k">input</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w">       </span><span class="c1">// The 8-bit slice</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#uarch-mul-div-unit-__codelineno-4-4"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">Product</span><span class="w">  </span><span class="c1">// Result (32 + 8 = 40 bits max)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#uarch-mul-div-unit-__codelineno-4-5"></a><span class="p">);</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#uarch-mul-div-unit-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#uarch-mul-div-unit-__codelineno-4-7"></a><span class="w">    </span><span class="c1">// // Generate Partial Products (Shift A based on bit position of B)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#uarch-mul-div-unit-__codelineno-4-8"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">8</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#uarch-mul-div-unit-__codelineno-4-9"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">7</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#uarch-mul-div-unit-__codelineno-4-10"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">6</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">2</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#uarch-mul-div-unit-__codelineno-4-11"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">5</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">3</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#uarch-mul-div-unit-__codelineno-4-12"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">4</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#uarch-mul-div-unit-__codelineno-4-13"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">3</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">5</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#uarch-mul-div-unit-__codelineno-4-14"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">2</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">6</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#uarch-mul-div-unit-__codelineno-4-15"></a><span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">pp7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mh">7</span><span class="mb">&#39;b0</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">40</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#uarch-mul-div-unit-__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#uarch-mul-div-unit-__codelineno-4-17"></a><span class="w">    </span><span class="c1">// Sum them up (Tree adder is faster, but this simple chain works also)</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#uarch-mul-div-unit-__codelineno-4-18"></a><span class="w">    </span><span class="k">assign</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pp0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pp7</span><span class="p">;</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#uarch-mul-div-unit-__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#uarch-mul-div-unit-__codelineno-4-20"></a><span class="k">endmodule</span>
</span></code></pre></div>
<p>This is totally valid. However, the smart synthesizer will generate the same hardware for both implementations.</p>
</details>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The 8 bits design will still use more hardware than I thought, which will give around 13ns propagation delay. This will limit the Mach-V clock frequency to 50MHz max if the clock wizard is not used!</p>
</div>
<hr />
<h4 id="uarch-mul-div-unit-divide-unit">Divide Unit<a class="headerlink" href="#uarch-mul-div-unit-divide-unit" title="Permanent link">&para;</a></h4>
<p>Similarly, I did the unrolling for the divider unit as well. So, instead of getting at most 1 bit of quotient and remainder per cycle. Now, I can get at most 8 bits of quotient and remainder per cycle. This divider unit is implemented using the <code>for</code> loop in Verilog as follows:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#uarch-mul-div-unit-__codelineno-5-1"></a><span class="k">module</span><span class="w"> </span><span class="n">DivSlice8</span><span class="w"> </span><span class="p">#(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#uarch-mul-div-unit-__codelineno-5-2"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#uarch-mul-div-unit-__codelineno-5-3"></a><span class="p">)</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#uarch-mul-div-unit-__codelineno-5-4"></a><span class="w">    </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rem_in</span><span class="p">,</span><span class="w">   </span><span class="c1">// Current Remainder</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#uarch-mul-div-unit-__codelineno-5-5"></a><span class="w">    </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">div_in</span><span class="p">,</span><span class="w">   </span><span class="c1">// Current Divisor</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#uarch-mul-div-unit-__codelineno-5-6"></a><span class="w">    </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="w">  </span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">quot_in</span><span class="p">,</span><span class="w">  </span><span class="c1">// Current Quotient (LSW of buffer)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#uarch-mul-div-unit-__codelineno-5-7"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rem_out</span><span class="p">,</span><span class="w">  </span><span class="c1">// Next Remainder</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#uarch-mul-div-unit-__codelineno-5-8"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">div_out</span><span class="p">,</span><span class="w">  </span><span class="c1">// Next Divisor</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#uarch-mul-div-unit-__codelineno-5-9"></a><span class="w">    </span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="w">  </span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">quot_out</span><span class="w">  </span><span class="c1">// Next Quotient</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#uarch-mul-div-unit-__codelineno-5-10"></a><span class="p">);</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#uarch-mul-div-unit-__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#uarch-mul-div-unit-__codelineno-5-12"></a><span class="w">    </span><span class="c1">// Temporary variable for subtraction</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#uarch-mul-div-unit-__codelineno-5-13"></a><span class="w">    </span><span class="k">integer</span><span class="w">             </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#uarch-mul-div-unit-__codelineno-5-14"></a><span class="w">    </span><span class="kt">reg</span><span class="w">     </span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="nl">width:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">diff_ext</span><span class="p">;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#uarch-mul-div-unit-__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#uarch-mul-div-unit-__codelineno-5-16"></a><span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#uarch-mul-div-unit-__codelineno-5-17"></a><span class="w">        </span><span class="c1">// Initialize temporary variables with inputs</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#uarch-mul-div-unit-__codelineno-5-18"></a><span class="w">        </span><span class="n">rem_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rem_in</span><span class="p">;</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#uarch-mul-div-unit-__codelineno-5-19"></a><span class="w">        </span><span class="n">div_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">div_in</span><span class="p">;</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#uarch-mul-div-unit-__codelineno-5-20"></a><span class="w">        </span><span class="n">quot_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quot_in</span><span class="p">;</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#uarch-mul-div-unit-__codelineno-5-21"></a>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#uarch-mul-div-unit-__codelineno-5-22"></a><span class="w">        </span><span class="c1">// Perform 8 iterations of division logic (Combinational Loop)</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#uarch-mul-div-unit-__codelineno-5-23"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#uarch-mul-div-unit-__codelineno-5-24"></a><span class="w">            </span><span class="c1">// 1. Subtract: Remainder - Divisor</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#uarch-mul-div-unit-__codelineno-5-25"></a><span class="w">            </span><span class="n">diff_ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">rem_out</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">div_out</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#uarch-mul-div-unit-__codelineno-5-26"></a>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#uarch-mul-div-unit-__codelineno-5-27"></a><span class="w">            </span><span class="c1">// 2. Check Sign</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#uarch-mul-div-unit-__codelineno-5-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">diff_ext</span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#uarch-mul-div-unit-__codelineno-5-29"></a><span class="w">                </span><span class="c1">// Result Positive: Update Remainder, Shift 1 into Quotient</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#uarch-mul-div-unit-__codelineno-5-30"></a><span class="w">                </span><span class="n">rem_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff_ext</span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#uarch-mul-div-unit-__codelineno-5-31"></a><span class="w">                </span><span class="n">quot_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">quot_out</span><span class="p">[</span><span class="n">width</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">};</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#uarch-mul-div-unit-__codelineno-5-32"></a><span class="w">            </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#uarch-mul-div-unit-__codelineno-5-33"></a><span class="w">                </span><span class="c1">// Result Negative: Keep Remainder, Shift 0 into Quotient</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#uarch-mul-div-unit-__codelineno-5-34"></a><span class="w">                </span><span class="n">quot_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">quot_out</span><span class="p">[</span><span class="n">width</span><span class="o">-</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">};</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#uarch-mul-div-unit-__codelineno-5-35"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#uarch-mul-div-unit-__codelineno-5-36"></a>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#uarch-mul-div-unit-__codelineno-5-37"></a><span class="w">            </span><span class="c1">// 3. Shift Divisor Right for the next step</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#uarch-mul-div-unit-__codelineno-5-38"></a><span class="w">            </span><span class="n">div_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">div_out</span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">1</span><span class="p">]};</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#uarch-mul-div-unit-__codelineno-5-39"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#uarch-mul-div-unit-__codelineno-5-40"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#uarch-mul-div-unit-__codelineno-5-41"></a><span class="k">endmodule</span>
</span></code></pre></div>
<p>To use the result from the divider unit, the state machine control can just be modified by updating the current remainder and quotient to be the result from the divider unit after each cycle:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#uarch-mul-div-unit-__codelineno-6-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#uarch-mul-div-unit-__codelineno-6-2"></a><span class="w">    </span><span class="n">rem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_rem</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#uarch-mul-div-unit-__codelineno-6-3"></a><span class="w">    </span><span class="n">div</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_div</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#uarch-mul-div-unit-__codelineno-6-4"></a><span class="w">    </span><span class="n">div_result_buf</span><span class="p">[</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_quot</span><span class="p">;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#uarch-mul-div-unit-__codelineno-6-5"></a><span class="w">    </span><span class="n">div_result_buf</span><span class="p">[</span><span class="mh">2</span><span class="o">*</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="n">width</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rem</span><span class="p">[</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#uarch-mul-div-unit-__codelineno-6-6"></a><span class="k">end</span>
</span></code></pre></div>
<p>And finally, this divider unit is implemented as follows in the <code>MCycle</code> module:</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#uarch-mul-div-unit-__codelineno-7-1"></a><span class="n">DivSlice8</span><span class="w"> </span><span class="n">div_unit</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#uarch-mul-div-unit-__codelineno-7-2"></a><span class="w">    </span><span class="p">.</span><span class="n">rem_in</span><span class="w">  </span><span class="p">(</span><span class="n">rem</span><span class="p">),</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#uarch-mul-div-unit-__codelineno-7-3"></a><span class="w">    </span><span class="p">.</span><span class="n">div_in</span><span class="w">  </span><span class="p">(</span><span class="n">div</span><span class="p">),</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#uarch-mul-div-unit-__codelineno-7-4"></a><span class="w">    </span><span class="p">.</span><span class="n">quot_in</span><span class="w"> </span><span class="p">(</span><span class="n">div_result_buf</span><span class="p">[</span><span class="n">width</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]),</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#uarch-mul-div-unit-__codelineno-7-5"></a><span class="w">    </span><span class="p">.</span><span class="n">rem_out</span><span class="w"> </span><span class="p">(</span><span class="n">next_rem</span><span class="p">),</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#uarch-mul-div-unit-__codelineno-7-6"></a><span class="w">    </span><span class="p">.</span><span class="n">div_out</span><span class="w"> </span><span class="p">(</span><span class="n">next_div</span><span class="p">),</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#uarch-mul-div-unit-__codelineno-7-7"></a><span class="w">    </span><span class="p">.</span><span class="n">quot_out</span><span class="p">(</span><span class="n">next_quot</span><span class="p">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#uarch-mul-div-unit-__codelineno-7-8"></a><span class="p">);</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Using the unrolling techniue in the divider unit here will use a lot of hardware! iirc, the propagation delay is around 66ns for this design! Given that high propagation delay, it is impossible to use this design on Mach-V. So, I moved on to the next section, which is to use Xilinix IP core for the multiply and divide unit.</p>
</div>
<h3 id="uarch-mul-div-unit-amd-ip-design">AMD IP Design<a class="headerlink" href="#uarch-mul-div-unit-amd-ip-design" title="Permanent link">&para;</a></h3>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-1.0">1.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-plugin" title="External IP / Plugin"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5.5L18.5 3H17v6a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V3zm7 1v5h3V4zm-5 8h10a1 1 0 0 1 1 1v6H6v-6a1 1 0 0 1 1-1"/></svg></span></a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p>As mentioned in the <a href="#uarch-mul-div-unit-native-design">previous documentation</a>, if I only use the unrolling technique, it is impossible to reach higher frequency while keeping the cycles for multiplication and division low. Therefore, I decided to use the AMD IP cores (Multiplier and Divider) to implement the multiply and divide unit.</p>
<hr />
<h4 id="uarch-mul-div-unit-generate-the-ip-core">Generate the IP Core<a class="headerlink" href="#uarch-mul-div-unit-generate-the-ip-core" title="Permanent link">&para;</a></h4>
<p>The <a href="https://www.amd.com/en/products/adaptive-socs-and-fpgas/intellectual-property/multiplier.html">multiplier IP core</a> comes from AMD and can be used in Vivado directly.</p>
<p>To use the IP in Vivado, click the "IP Catalog" on the left flow navigator. Then, search for "multiplier". Click the "Multiplier" (not "Complex Multiplier"). And then configure the IP to use the following settings:</p>
<ol>
<li>In the "Basic" tab:<ul>
<li>Set Multiplier Type to "Parallel Multiplier"</li>
<li>Set <code>A</code> and <code>B</code> to be "unsigned" and "32-bit" wide</li>
<li>Set Multiplier Construction to "Use Mults"</li>
<li>Set the Optimization Options to "Speed Optimized"</li>
</ul>
</li>
<li>In the "Output and Control" tab<ul>
<li>Make sure the <code>P</code> (output) is 64-bit wide.</li>
<li>Set the Pipeline Stages to 4.</li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>With the above settings, the multiplier IP core will take 5 cycles to complete and the propagation is safer for the processor to reach 100MHz and higher.</p>
</div>
<p>Simiarly, the <a href="https://www.amd.com/en/products/adaptive-socs-and-fpgas/intellectual-property/divider.html">divider IP core</a> also comes from AMD and can be used in Vivado directly.</p>
<p>Follow the similar steps as the multiplier IP core, but configure the divider using the following settings:</p>
<ol>
<li>In the "Channel Settings" tab:<ul>
<li>Set Algorithm type of "Radix 2" and Operand sign to "unsigned".</li>
<li>Change dividend and divisor width to "32".</li>
<li>Set the Remainder Type to be "Remainder" and fractional width to be "32".</li>
</ul>
</li>
<li>In the "Options" tab:<ul>
<li>Set Clocks per Division to be "1".</li>
<li>Set the flow control under AXI4-Stream settings to "Blocking".</li>
<li>Set the optimize goal under AXI4-Stream settings to "Performance".</li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>With the above settings, the divider IP core will take 32 cycles to complete and the propagation is safer for the processor to reach 100MHz and higher.</p>
</div>
<hr />
<h4 id="uarch-mul-div-unit-use-ip-core">Use IP Core<a class="headerlink" href="#uarch-mul-div-unit-use-ip-core" title="Permanent link">&para;</a></h4>
<p>To use the two IP cores that we have generated above, we just need to know the inputs and outputs of each IP core and then instantiate them in our <code>MCycle.v</code> to replace the multiple unit and the divide unit that we have implemented manually in the <a href="#uarch-mul-div-unit-native-design">previous section</a>.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#uarch-mul-div-unit-__codelineno-8-1"></a><span class="c1">// Multiplier IP: 32x32 Unsigned -&gt; 64-bit Product</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#uarch-mul-div-unit-__codelineno-8-2"></a><span class="n">mult_gen_0</span><span class="w"> </span><span class="n">my_multiplier</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#uarch-mul-div-unit-__codelineno-8-3"></a><span class="w">    </span><span class="p">.</span><span class="n">CLK</span><span class="p">(</span><span class="n">CLK</span><span class="p">),</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#uarch-mul-div-unit-__codelineno-8-4"></a><span class="w">    </span><span class="p">.</span><span class="n">A</span><span class="w">  </span><span class="p">(</span><span class="n">abs_op1</span><span class="p">),</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#uarch-mul-div-unit-__codelineno-8-5"></a><span class="w">    </span><span class="p">.</span><span class="n">B</span><span class="w">  </span><span class="p">(</span><span class="n">abs_op2</span><span class="p">),</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#uarch-mul-div-unit-__codelineno-8-6"></a><span class="w">    </span><span class="p">.</span><span class="n">P</span><span class="w">  </span><span class="p">(</span><span class="n">mul_dout</span><span class="p">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#uarch-mul-div-unit-__codelineno-8-7"></a><span class="p">);</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#uarch-mul-div-unit-__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#uarch-mul-div-unit-__codelineno-8-9"></a><span class="c1">// Divider IP: 32/32 Unsigned -&gt; 32 Quot, 32 Rem</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#uarch-mul-div-unit-__codelineno-8-10"></a><span class="n">div_gen_0</span><span class="w"> </span><span class="n">my_divider</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#uarch-mul-div-unit-__codelineno-8-11"></a><span class="w">    </span><span class="p">.</span><span class="n">aclk</span><span class="w">                  </span><span class="p">(</span><span class="n">CLK</span><span class="p">),</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#uarch-mul-div-unit-__codelineno-8-12"></a><span class="w">    </span><span class="p">.</span><span class="n">s_axis_divisor_tvalid</span><span class="w"> </span><span class="p">(</span><span class="n">div_in_valid</span><span class="p">),</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#uarch-mul-div-unit-__codelineno-8-13"></a><span class="w">    </span><span class="p">.</span><span class="n">s_axis_divisor_tdata</span><span class="w">  </span><span class="p">(</span><span class="n">abs_op2</span><span class="p">),</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#uarch-mul-div-unit-__codelineno-8-14"></a><span class="w">    </span><span class="p">.</span><span class="n">s_axis_dividend_tvalid</span><span class="p">(</span><span class="n">div_in_valid</span><span class="p">),</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#uarch-mul-div-unit-__codelineno-8-15"></a><span class="w">    </span><span class="p">.</span><span class="n">s_axis_dividend_tdata</span><span class="w"> </span><span class="p">(</span><span class="n">abs_op1</span><span class="p">),</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#uarch-mul-div-unit-__codelineno-8-16"></a><span class="w">    </span><span class="p">.</span><span class="n">m_axis_dout_tvalid</span><span class="w">    </span><span class="p">(</span><span class="n">div_out_valid</span><span class="p">),</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#uarch-mul-div-unit-__codelineno-8-17"></a><span class="w">    </span><span class="p">.</span><span class="n">m_axis_dout_tdata</span><span class="w">     </span><span class="p">(</span><span class="n">div_dout</span><span class="p">)</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#uarch-mul-div-unit-__codelineno-8-18"></a><span class="p">);</span>
</span></code></pre></div></section><section class="print-page" id="uarch-lsu" heading-number="2.6"><h1 id="uarch-lsu-load-store-unit">Load &amp; Store Unit<a class="headerlink" href="#uarch-lsu-load-store-unit" title="Permanent link">&para;</a></h1>
<p>Unlike the baseline design from NUS CG3207, Mach-V extends memory support beyond full-word operations. The Load Store Unit (LSU) module handles byte (<code>lb</code>/<code>lbu</code>/<code>sb</code>) and half-word (<code>lh</code>/<code>lhu</code>/<code>sh</code>) transactions, ensuring correct data alignment and sign extension.</p>
<p>The LSU will take 5 inputs and produce 3 outputs:</p>
<h2 id="uarch-lsu-interface-definition">Interface Definition<a class="headerlink" href="#uarch-lsu-interface-definition" title="Permanent link">&para;</a></h2>
<p>The LSU locates in the Mem stage. It processes raw addresses and data to align them with the memory's 32-bit word boundaries.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Direction</th>
<th style="text-align: left;">Signal</th>
<th style="text-align: center;">Width</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;">Funct3</td>
<td style="text-align: center;">3</td>
<td style="text-align: left;">Instruction function code (determines size and signing).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;">MemWriteM</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Write Enable signal from the Control Unit.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;">WriteDataM</td>
<td style="text-align: center;">32</td>
<td style="text-align: left;">Raw data to be written.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;">ReadData_in</td>
<td style="text-align: center;">32</td>
<td style="text-align: left;">Raw 32-bit word read from Data Memory.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;">ByteOffset</td>
<td style="text-align: center;">2</td>
<td style="text-align: left;">The 2 Least Significant Bits (LSB) of the memory address.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;">MemWrite_out</td>
<td style="text-align: center;">4</td>
<td style="text-align: left;">Byte-enable mask sent to Data Memory (1 bit per byte).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;">WriteData_out</td>
<td style="text-align: center;">32</td>
<td style="text-align: left;">Aligned data sent to Data Memory.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;">ReadDataM</td>
<td style="text-align: center;">32</td>
<td style="text-align: left;">Processed data (shifted/extended) sent to Writeback.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Naming Convention</p>
<p>The term "Load Store Unit" typically refers to a complex buffer system in Out-of-Order processors. In the context of the current Mach-V (Scalar In-Order), it refers specifically to the alignment and formatting logic within the Memory stage.</p>
</div>
<h2 id="uarch-lsu-store-alignment-logic">Store Alignment Logic<a class="headerlink" href="#uarch-lsu-store-alignment-logic" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-1.0">1.0</a></span></span></p>
<p>The Store Unit is responsible for placing data into the correct "byte lane" before writing to memory. Since memory is word-addressed (32-bit width), sub-word stores (like <code>sb</code>) must be shifted to the correct position within the word.</p>
<ol>
<li><strong>Calculate Shift Amount:</strong> The <code>ByteOffset</code> is multiplied by 8 (concatenated with <code>3'b000</code>) to convert the byte index into a bit index.</li>
<li><strong>Align Data:</strong> The raw <code>WriteDataM</code> is logically left-shifted (<code>&lt;&lt;</code>) by this amount.</li>
<li><strong>Generate Mask</strong>: A base mask is selected based on the instruction type (e.g., <code>0001</code> for Byte, <code>0011</code> for Half-word) and then shifted to the active position.</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Exmaple from NUS CG3207 Teaching Team</p>
<p><code>WriteData_out</code> is a word, with word/byte/half-word aligned to where you wish to write it to within the word. The <code>MemWrite_out</code> bits of every byte to be modified should be 1. For example, when running <code>sb</code> (store byte) instruction, if the last 2 bits of the address is <code>2'b10</code> and the byte to be written (<code>WriteDataM</code>) is <code>8'hAB</code> (or <code>32'b000000AB</code>), <code>WriteData_out</code> should be <code>32'hxxABxxxx</code> and <code>MemWrite_out</code> should be <code>4'h0100</code>.</p>
</div>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#uarch-lsu-__codelineno-0-1"></a><span class="c1">// --- STORE PATH (Alignment &amp; Masking) ---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#uarch-lsu-__codelineno-0-2"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">shamt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">ByteOffset</span><span class="p">,</span><span class="w"> </span><span class="mh">3</span><span class="mb">&#39;b000</span><span class="p">};</span><span class="w">  </span><span class="c1">// Offset * 8</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#uarch-lsu-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#uarch-lsu-__codelineno-0-4"></a><span class="c1">// Align Data</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#uarch-lsu-__codelineno-0-5"></a><span class="k">assign</span><span class="w"> </span><span class="n">WriteData_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WriteDataM</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">shamt</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#uarch-lsu-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#uarch-lsu-__codelineno-0-7"></a><span class="c1">// Generate Mask</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#uarch-lsu-__codelineno-0-8"></a><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">BaseMask</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#uarch-lsu-__codelineno-0-9"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#uarch-lsu-__codelineno-0-10"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">Funct3</span><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#uarch-lsu-__codelineno-0-11"></a><span class="w">        </span><span class="mh">3</span><span class="mb">&#39;b000</span><span class="o">:</span><span class="w"> </span><span class="n">BaseMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0001</span><span class="p">;</span><span class="w">  </span><span class="c1">// SB</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#uarch-lsu-__codelineno-0-12"></a><span class="w">        </span><span class="mh">3</span><span class="mb">&#39;b001</span><span class="o">:</span><span class="w"> </span><span class="n">BaseMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0011</span><span class="p">;</span><span class="w">  </span><span class="c1">// SH</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#uarch-lsu-__codelineno-0-13"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="n">BaseMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b1111</span><span class="p">;</span><span class="w">  </span><span class="c1">// SW</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#uarch-lsu-__codelineno-0-14"></a><span class="w">    </span><span class="k">endcase</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#uarch-lsu-__codelineno-0-15"></a><span class="k">end</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#uarch-lsu-__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#uarch-lsu-__codelineno-0-17"></a><span class="c1">// Shift Mask</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#uarch-lsu-__codelineno-0-18"></a><span class="k">assign</span><span class="w"> </span><span class="n">MemWrite_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MemWriteM</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">BaseMask</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ByteOffset</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0000</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="uarch-lsu-load-extension-logic">Load Extension Logic<a class="headerlink" href="#uarch-lsu-load-extension-logic" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-1.0">1.0</a></span></span></p>
<p>The Load Unit performs the inverse operation. It takes a full 32-bit word from memory and extracts the relevant byte or half-word.</p>
<ol>
<li><strong>Re-Align</strong>: The raw <code>ReadData_in</code> is right-shifted (<code>&gt;&gt;</code>) by <code>ByteOffset</code> bits so that the desired data sits in the Least Significant Bits (LSB).</li>
<li><strong>Sign Extension</strong>: Based on <code>Funct3</code>, the logic decides whether to zero-extend (for <code>lbu</code>, <code>lhu</code>) or sign-extend (for <code>lb</code>, <code>lh</code>) the result to fill the 32-bit register.</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Example from NUS CG3207 Teaching Team</p>
<p><code>ReadData_in</code> is the whole word that contains the word/half-word/byte you want. You need to extract what you want, with a sign/zero(<code>u</code>) extension as required by the instruction. For example, when running <code>lbu</code> (load byte unsigned) instruction, if the last 2 bits of the address is <code>2'b01</code>, and the address location specified in the instruction has <code>8'hAB</code>, <code>ReadData_in</code> is <code>32'hxxxxABxx</code>. <code>ReadDataM</code>, the word to be written into the destination register is <code>32'h000000AB</code> (<code>0</code>s as MSBs as it is <code>lbu</code>).</p>
</div>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#uarch-lsu-__codelineno-1-1"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">data_shifted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadData_in</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">shamt</span><span class="p">;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#uarch-lsu-__codelineno-1-2"></a><span class="kt">reg</span><span class="w">  </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">loaded_val</span><span class="p">;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#uarch-lsu-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#uarch-lsu-__codelineno-1-4"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#uarch-lsu-__codelineno-1-5"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">Funct3</span><span class="p">)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#uarch-lsu-__codelineno-1-6"></a><span class="w">        </span><span class="mh">3</span><span class="mb">&#39;b000</span><span class="o">:</span><span class="w"> </span><span class="n">loaded_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mh">24</span><span class="p">{</span><span class="n">data_shifted</span><span class="p">[</span><span class="mh">7</span><span class="p">]}},</span><span class="w"> </span><span class="n">data_shifted</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]};</span><span class="w">  </span><span class="c1">// LB</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#uarch-lsu-__codelineno-1-7"></a><span class="w">        </span><span class="mh">3</span><span class="mb">&#39;b001</span><span class="o">:</span><span class="w"> </span><span class="n">loaded_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mh">16</span><span class="p">{</span><span class="n">data_shifted</span><span class="p">[</span><span class="mh">15</span><span class="p">]}},</span><span class="w"> </span><span class="n">data_shifted</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]};</span><span class="w">  </span><span class="c1">// LH</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#uarch-lsu-__codelineno-1-8"></a><span class="w">        </span><span class="mh">3</span><span class="mb">&#39;b100</span><span class="o">:</span><span class="w"> </span><span class="n">loaded_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">24</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">data_shifted</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]};</span><span class="w">  </span><span class="c1">// LBU</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#uarch-lsu-__codelineno-1-9"></a><span class="w">        </span><span class="mh">3</span><span class="mb">&#39;b101</span><span class="o">:</span><span class="w"> </span><span class="n">loaded_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">16</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="w"> </span><span class="n">data_shifted</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]};</span><span class="w">  </span><span class="c1">// LHU</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#uarch-lsu-__codelineno-1-10"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="n">loaded_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_shifted</span><span class="p">;</span><span class="w">  </span><span class="c1">// LW</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#uarch-lsu-__codelineno-1-11"></a><span class="w">    </span><span class="k">endcase</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#uarch-lsu-__codelineno-1-12"></a><span class="k">end</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#uarch-lsu-__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#uarch-lsu-__codelineno-1-14"></a><span class="k">assign</span><span class="w"> </span><span class="n">ReadDataM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loaded_val</span><span class="p">;</span>
</span></code></pre></div></section><section class="print-page" id="uarch-hazard-unit" heading-number="2.7"><h1 id="uarch-hazard-unit-hazard-handling-unit">Hazard Handling Unit<a class="headerlink" href="#uarch-hazard-unit-hazard-handling-unit" title="Permanent link">&para;</a></h1>
<p>The Hazard Handling Unit manages the data and control hazards inherent in Mach-V's 5-stage pipeline architecture. Its primary responsibilities are divided into two logic blocks:</p>
<ol>
<li><strong>Data Forwarding Logic</strong>: Resolves data hazards by bypassing results from later stages.</li>
<li><strong>Stall &amp; Flush Logic</strong>: Resolves load-use and control hazards by stalling or clearing pipeline registers.</li>
</ol>
<h2 id="uarch-hazard-unit-forwarding-logic">Forwarding Logic<a class="headerlink" href="#uarch-hazard-unit-forwarding-logic" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-1.0">1.0</a></span></span></p>
<p>The stall &amp; flush logic mainly deals with the load-use hazard and control hazard. The version that Mach-V Version 1 uses are also strictly following the rules introduced in NUS CG3207 or in Harris &amp; Harris DDCA.</p>
<p>Specific implementation details can be found in the source code Hazard.v and strictly follow the datapath connections shown in the microarchitecture diagram.</p>
<h2 id="uarch-hazard-unit-stall-flush-logic">Stall &amp; Flush Logic<a class="headerlink" href="#uarch-hazard-unit-stall-flush-logic" title="Permanent link">&para;</a></h2>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-1.0">1.0</a></span></span></p>
<p>The base implementation of the Stall &amp; Flush logic handles standard Load-Use hazards and Control hazards, also following NUS CG3207 and DDCA (Harris &amp; Harris) model.</p>
<h3 id="uarch-hazard-unit-modifications-for-mem-stage-branching">Modifications for Mem Stage Branching<a class="headerlink" href="#uarch-hazard-unit-modifications-for-mem-stage-branching" title="Permanent link">&para;</a></h3>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-2.0">2.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p>To support moving the PC Logic to the Memory (Mem) stage, significant modifications were required to the interaction between the Hazard Unit, the Stall signals, and the Multi-Cycle Unit.</p>
<hr />
<h4 id="uarch-hazard-unit-priority-inversion-the-lost-jump-scenario">Priority Inversion: The "Lost Jump" Scenario<a class="headerlink" href="#uarch-hazard-unit-priority-inversion-the-lost-jump-scenario" title="Permanent link">&para;</a></h4>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-2.0">2.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p><strong>The problem</strong>: When a branch/jump instruction reaches the Mem stage and resolves to branch/jump, the instruction immediately following it (the "ghost" instruction) is already in the Execute or Decode stage. If this ghost instruction triggers a Hazard Stall (e.g., a Load-Use stall or a Multi-Cycle Busy signal), a conflict arises.</p>
<p>In the previous design, the PC update logic prioritized <code>StallF</code> over the new PC target (<code>PC_IN</code>). Because <code>StallF</code> was high (caused by the ghost instruction), the PC retained its current value, effectively ignoring the jump request. This caused the CPU to "fall through" and execute instructions that should have been skipped.</p>
<p><strong>The Solution</strong>: Control flow changes must be prioritized over stall signals. I modified the logic to force stall signals to <code>0</code> whenever a branch or jump is confirmed (<code>PCSrcM</code> is active). This ensures that if the processor is jumping, hazards caused by instructions in the flush shadow are ignored.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#uarch-hazard-unit-__codelineno-0-1"></a><span class="c1">// Before: Stall logic only looked at hazards</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#uarch-hazard-unit-__codelineno-0-2"></a><span class="c1">// assign StallF = lwStall | Busy;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#uarch-hazard-unit-__codelineno-0-3"></a><span class="c1">// assign StallD = lwStall | Busy;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#uarch-hazard-unit-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#uarch-hazard-unit-__codelineno-0-5"></a><span class="c1">// After: Force Stall to 0 if a branch (PCSrcM[0]) is happening</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#uarch-hazard-unit-__codelineno-0-6"></a><span class="k">assign</span><span class="w"> </span><span class="n">StallF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lwStall</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Busy</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">PCSrcM</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#uarch-hazard-unit-__codelineno-0-7"></a><span class="k">assign</span><span class="w"> </span><span class="n">StallD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lwStall</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Busy</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">PCSrcM</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span>
</span></code></pre></div>
<hr />
<h4 id="uarch-hazard-unit-spurious-execution-in-muldiv-operations">Spurious Execution in Mul/Div Operations<a class="headerlink" href="#uarch-hazard-unit-spurious-execution-in-muldiv-operations" title="Permanent link">&para;</a></h4>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span><span class="mdx-badge__text"><a href="#sw-changelog-2.0">2.0</a></span></span>
<span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span></p>
<p><strong>The Problem</strong>: When a branch/jump instruction takes a branch/jump in the Mem stage, the subsequent instruction (e.g., a <code>mul</code>) may have already advanced to the Execute stage.</p>
<p>Although the Hazard Unit asserts <code>FlushE</code> to kill the <code>mul</code> for the next clock cycle, the MCycle Unit is combinational logic that reacts to its inputs instantly. It sees the <code>Start</code> signal immediately in the current cycle, begins the calculation, and raises the <code>Busy</code> flag. This stalls the entire processor to perform a "fake" multiplication that is about to be flushed.</p>
<p>The Solution: I modified the instantiation of the MCycle Unit in <code>RV.v</code> to logically "gate" the start signal. If the Execute stage is currently being flushed (<code>FlushE</code> is high), the <code>.Start</code> input is forced to <code>0</code>. This prevents the unit from activating on instructions that are being discarded.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#uarch-hazard-unit-__codelineno-1-1"></a><span class="n">MCycle</span><span class="w"> </span><span class="p">#(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#uarch-hazard-unit-__codelineno-1-2"></a><span class="w">    </span><span class="p">.</span><span class="n">width</span><span class="p">(</span><span class="mh">32</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#uarch-hazard-unit-__codelineno-1-3"></a><span class="p">)</span><span class="w"> </span><span class="n">MCycle1</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#uarch-hazard-unit-__codelineno-1-4"></a><span class="w">    </span><span class="c1">// ... other ports ...</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#uarch-hazard-unit-__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#uarch-hazard-unit-__codelineno-1-6"></a><span class="w">    </span><span class="c1">// Before: The unit starts immediately, ignoring the flush</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#uarch-hazard-unit-__codelineno-1-7"></a><span class="w">    </span><span class="c1">// .Start   (MCycleStartE),</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#uarch-hazard-unit-__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#uarch-hazard-unit-__codelineno-1-9"></a><span class="w">    </span><span class="c1">// After: The unit only starts if we are NOT flushing the stage</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#uarch-hazard-unit-__codelineno-1-10"></a><span class="w">    </span><span class="p">.</span><span class="n">Start</span><span class="w">   </span><span class="p">(</span><span class="n">MCycleStartE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">FlushE</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#uarch-hazard-unit-__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#uarch-hazard-unit-__codelineno-1-12"></a><span class="w">    </span><span class="p">.</span><span class="n">Busy</span><span class="w">    </span><span class="p">(</span><span class="n">Busy</span><span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#uarch-hazard-unit-__codelineno-1-13"></a><span class="p">);</span>
</span></code></pre></div></section></section>
                    <section class='print-page md-section' id='section-3' heading-number='3'>
                        <h1>Simulation<a class='headerlink' href='#section-3' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="sim" heading-number="3.1"><h1 id="sim-simulation">Simulation<a class="headerlink" href="#sim-simulation" title="Permanent link">&para;</a></h1>
<p>This section outlines the verification strategy for the Mach-V processor.</p>
<h2 id="sim-simulation-directory-structure">Simulation Directory Structure<a class="headerlink" href="#sim-simulation-directory-structure" title="Permanent link">&para;</a></h2>
<p>The <code>sim/</code> directory contains all testbench and verification artifacts:</p>
<ul>
<li><strong><code>sim/tb/</code></strong>: Verilog testbenches mapped to specific <a href="#sw">software applications</a>.</li>
<li><strong><code>sim/mem/</code></strong>: Pre-compiled memory files (in hexadecimal format) used to initialize IROM and DMEM for simulation.</li>
</ul>
<h2 id="sim-toolchain-setup">Toolchain Setup<a class="headerlink" href="#sim-toolchain-setup" title="Permanent link">&para;</a></h2>
<p>The primary tool used for simulation is <strong><a href="https://www.xilinx.com/support/download.html">Vivado 2025.2</a></strong>. For installation instructions, refer to the <a href="https://nus-cg3207.github.io/labs/getting_started/vivado_install_guide/">NUS CG3207 Lab Guide</a> or consult the official Xilinx documentation.</p>
<h2 id="sim-simulation-guide">Simulation Guide<a class="headerlink" href="#sim-simulation-guide" title="Permanent link">&para;</a></h2>
<p>Simulations for Mach-V are performed by targeting the Wrapper.v module as the Device Under Test (DUT). Acting effectively as a virtual motherboard, this module connects the processor core to peripherals like UART and memory.</p>
<h3 id="sim-debugging-the-pipelined-processor">Debugging the Pipelined Processor<a class="headerlink" href="#sim-debugging-the-pipelined-processor" title="Permanent link">&para;</a></h3>
<p>Personally speaking, debugging a pipelined microarchitecture can be tedious due to instructions overlapping across different stages. To simplify this process, I recommend <strong>propagating the current PC value through every stage of the pipeline</strong>.</p>
<p>By latching <code>PCF</code> into successive pipeline registers (e.g., <code>PCD</code>, <code>PCE</code>, <code>PCM</code>, <code>PCW</code>), you can easily identify exactly which instruction is occupying a specific stage at any given cycle.</p>
<p>For example, the waveform below shows the Decode (Dec) stage while executing the <a href="https://www.google.com/search?q=../sw/benchmark.md">Coremark</a> application:</p>
<figure>
<p><img alt="Decode Stage with PC Propagation" src="../assets/images/sim-debug-pipeline-design.png" /></p>
<figcaption>
<p>Decode Stage with PC Propagation</p>
</figcaption>
</figure>
<p>In the waveform above, the <code>PCD</code> signal indicates the instruction currently residing in the Dec stage. This makes it significantly easier to verify if the control signals match the expected behavior. For reference, here is the corresponding snippet from <code>prog.dump</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#sim-__codelineno-0-1"></a>400000:   0080006f           j 400008 &lt;_init_reg&gt;
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#sim-__codelineno-0-2"></a>400004:   0000006f           j 400004 &lt;_end&gt;
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#sim-__codelineno-0-3"></a>400008:   00000093           li ra,0
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#sim-__codelineno-0-4"></a>40000c:   00000113           li sp,0
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#sim-__codelineno-0-5"></a>400010:   00000193           li gp,0
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#sim-__codelineno-0-6"></a>400014:   00000213           li tp,0
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While this method has been effective for Phase 2 of Mach-V, there may be more efficient debugging techniques. I will continue to explore other methods and update this section as the design evolves.</p>
</div>
<h3 id="sim-handling-fly-away-situations-undefined-states">Handling "Fly-Away" Situations (Undefined States)<a class="headerlink" href="#sim-handling-fly-away-situations-undefined-states" title="Permanent link">&para;</a></h3>
<p>Occasionally, you may encounter a situation where signals (such as <code>PCF</code>) suddenly transition to <code>XXX</code> (undefined). This usually indicates that the processor has entered an invalid state. These issues can be difficult to trace, but below are some common causes I have encountered.</p>
<div class="admonition info">
<p class="admonition-title">Rule of Thumb</p>
<p>Locate the <strong>last valid instruction</strong> in the waveform before the signals go undefined. Use the PC value of that instruction to find the corresponding RISC-V instruction in your <code>prog.dump</code> file (generated after running <code>make</code>).</p>
</div>
<hr />
<h4 id="sim-lw-loading-from-an-invalid-address"><code>lw</code> Loading from an Invalid Address<a class="headerlink" href="#sim-lw-loading-from-an-invalid-address" title="Permanent link">&para;</a></h4>
<p>This issue typically occurs when a load instruction attempts to access an address that is not mapped to the DMEM. If the data is missing from the memory initialization, the simulation returns undefined values.</p>
<p>To resolve this, check if the source address of the load instruction falls within a section that has been put into the DMEM. This kind of information is specified in the linker script (<code>ld.script</code>).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A common pitfall is the <code>.rodata</code> (read-only data) section. Ensure that <code>.rodata</code> is explicitly included in the DMEM mapping in your linker script.</p>
</div></section><section class="print-page" id="sim-benchmark_tb" heading-number="3.2"><h1 id="sim-benchmark_tb-benchmark-testbench">Benchmark Testbench<a class="headerlink" href="#sim-benchmark_tb-benchmark-testbench" title="Permanent link">&para;</a></h1>
<p>This testbench is designed for non-interactive applications, such as the <a href="#sw-benchmark-coremark-benchmark">CoreMark</a> benchmark. Its primary goal is to run the processor at full speed and capture the output without requiring manual user input.</p>
<h2 id="sim-benchmark_tb-key-features">Key features<a class="headerlink" href="#sim-benchmark_tb-key-features" title="Permanent link">&para;</a></h2>
<h3 id="sim-benchmark_tb-zero-stall-uart-configuration">Zero-Stall UART Configuration<a class="headerlink" href="#sim-benchmark_tb-zero-stall-uart-configuration" title="Permanent link">&para;</a></h3>
<p>Since the benchmark relies on printf for reporting results but has no human operator, the UART input is disabled, and the output is forced to be "always ready."</p>
<ul>
<li><strong>RX (Input)</strong>: <code>UART_RX_valid</code> is tied to <code>0</code>, ensuring the CPU never receives spurious input.</li>
<li><strong>TX (Output)</strong>: <code>UART_TX_ready</code> is hardcoded to <code>1</code>, preventing the CPU from stalling while waiting for the terminal to accept a character.</li>
</ul>
<h3 id="sim-benchmark_tb-output-monitoring">Output Monitoring<a class="headerlink" href="#sim-benchmark_tb-output-monitoring" title="Permanent link">&para;</a></h3>
<p>Instead of opening a graphical terminal, the testbench monitors the <code>UART_TX</code> line directly. Whenever the CPU asserts <code>UART_TX_valid</code>, the testbench grabs the character and prints it to the Vivado Tcl console using <code>$display</code>.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#sim-benchmark_tb-__codelineno-0-1"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">CLK</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#sim-benchmark_tb-__codelineno-0-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UART_TX_valid</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#sim-benchmark_tb-__codelineno-0-3"></a><span class="w">        </span><span class="c1">// Prints the ASCII character sent by the CPU</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#sim-benchmark_tb-__codelineno-0-4"></a><span class="w">        </span><span class="nb">$display</span><span class="p">(</span><span class="s">&quot;UART_TX: %h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UART_TX</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#sim-benchmark_tb-__codelineno-0-5"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#sim-benchmark_tb-__codelineno-0-6"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="sim-benchmark_tb-simulation-timeout">Simulation Timeout<a class="headerlink" href="#sim-benchmark_tb-simulation-timeout" title="Permanent link">&para;</a></h3>
<p>To prevent the simulation from running indefinitely (in case of software crashes or infinite loops), a hard limit is set. The simulation automatically stops after 50ms (5,000,000,000 ns), which is sufficient for one iteration of the benchmark.</p></section><section class="print-page" id="sim-uart_tb" heading-number="3.3"><h1 id="sim-uart_tb-uart-application-testbench">UART Application Testbench<a class="headerlink" href="#sim-uart_tb-uart-application-testbench" title="Permanent link">&para;</a></h1>
<p>This testbench verifies the interactive capabilities of the processor, specifically focusing on the <a href="#sw-uart_calculator">UART Calculator</a> application. Unlike the <a href="#sim-benchmark_tb">benchmark simulation</a>, this testbench actively injects data and adheres to a strict handshaking protocol.</p>
<h2 id="sim-uart_tb-the-send_uart-task">The <code>send_uart</code> Task<a class="headerlink" href="#sim-uart_tb-the-send_uart-task" title="Permanent link">&para;</a></h2>
<p>The core of this verification is the <code>send_uart</code> task, which automates the entry of complex commands. It constructs a 9-byte packet consisting of:</p>
<ol>
<li><strong>Command Byte</strong>: The ASCII character for the operation. (e.g., <code>d</code> for division. For the full list of commands, refer to the <a href="#sw-uart_calculator-command-reference">UART Calculator documentation</a>.)</li>
<li><strong>Operand 1 (4 bytes)</strong>: The first 32-bit number.</li>
<li><strong>Operand 2 (4 bytes)</strong>: The second 32-bit number.</li>
</ol>
<h3 id="sim-uart_tb-handshaking-protocol">Handshaking Protocol<a class="headerlink" href="#sim-uart_tb-handshaking-protocol" title="Permanent link">&para;</a></h3>
<p>The task simulates a real UART controller by waiting for the CPU to acknowledge receipt of each byte before sending the next.</p>
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#sim-uart_tb-__codelineno-0-1"></a><span class="c1">// Wait until CPU acknowledges (reads from UART_RX)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#sim-uart_tb-__codelineno-0-2"></a><span class="k">wait</span><span class="w"> </span><span class="p">(</span><span class="n">UART_RX_ack</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#sim-uart_tb-__codelineno-0-3"></a><span class="n">UART_RX_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#sim-uart_tb-__codelineno-0-4"></a><span class="c1">// Wait until CPU clears ack before sending next byte</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#sim-uart_tb-__codelineno-0-5"></a><span class="k">wait</span><span class="w"> </span><span class="p">(</span><span class="n">UART_RX_ack</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="sim-uart_tb-test-coverage">Test Coverage<a class="headerlink" href="#sim-uart_tb-test-coverage" title="Permanent link">&para;</a></h2>
<p>You are encouraged to extend tb_uart.v with additional test cases to verify specific scenarios. When adding new tests, please refer to the <a href="#sw-uart_calculator-command-reference">UART Calculator Command Reference</a> to ensure the correct the command code is used.</p></section></section>
                    <section class='print-page md-section' id='section-4' heading-number='4'>
                        <h1>Software<a class='headerlink' href='#section-4' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="sw" heading-number="4.1"><h1 id="sw-software-development-guide">Software Development Guide<a class="headerlink" href="#sw-software-development-guide" title="Permanent link">&para;</a></h1>
<p>This guide explains how to write, compile, and run different software on the Mach-V processor.</p>
<h2 id="sw-software-directory-structure">Software Directory Structure<a class="headerlink" href="#sw-software-directory-structure" title="Permanent link">&para;</a></h2>
<p>The <code>sw/</code> directory is organized by application. For example:</p>
<ul>
<li><code>sw/coremark/</code> contains the CoreMark benchmark source code and build scripts.</li>
</ul>
<h2 id="sw-system-memory-map">System Memory Map<a class="headerlink" href="#sw-system-memory-map" title="Permanent link">&para;</a></h2>
<p>Followed by the convention set in <a href="https://nus-cg3207.github.io/labs/rv_resources/rv_memmap/">NUS CG3207</a>, the Mach-V processor uses a memory-mapped I/O architecture. The address space is divided into Instruction Memory, Data Memory, and Peripheral (MMIO) regions.</p>
<div class="admonition info">
<p class="admonition-title">Configuration Source</p>
<p>The memory capacities defined below are determined by parameters in <code>Wrapper.v</code>. For example,
<div class="language-verilog highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#sw-__codelineno-0-1"></a><span class="k">localparam</span><span class="w"> </span><span class="n">IROM_DEPTH_BITS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">15</span><span class="p">;</span><span class="w">     </span><span class="c1">// for 2^15 words = 32KB</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#sw-__codelineno-0-2"></a><span class="k">localparam</span><span class="w"> </span><span class="n">DMEM_DEPTH_BITS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">14</span><span class="p">;</span><span class="w">     </span><span class="c1">// for 2^14 words = 16KB</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#sw-__codelineno-0-3"></a><span class="k">localparam</span><span class="w"> </span><span class="n">MMIO_DEPTH_BITS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="p">;</span><span class="w">      </span><span class="c1">// for 2^8 words = 1KB</span>
</span></code></pre></div></p>
<p>If you modify these parameters in <code>Wrapper.v</code>, you must update your linker script and stack initialization accordingly.</p>
</div>
<h3 id="sw-main-memory">Main Memory<a class="headerlink" href="#sw-main-memory" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Address Range</th>
<th>Name</th>
<th>Permissions</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0x00400000  0x00407FFF</code></td>
<td>IROM (Instruction Memory)</td>
<td>RO (Read-Only)</td>
<td>Capacity: 8,192 words (32 KB). Based on <code>IROM_DEPTH_BITS = 15</code>.</td>
</tr>
<tr>
<td><code>0x10010000  0x10013FFF</code></td>
<td>DMEM (Data Memory)</td>
<td>RW (Read-Write)</td>
<td>Capacity: 4,096 words (16 KB). Used for storing constants and variables. Based on <code>DMEM_DEPTH_BITS = 14</code>.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Addressing Constraints</p>
<p>Accesses must be aligned to 4-byte boundaries.</p>
</div>
<h3 id="sw-memory-mapped-peripherals-mmio">Memory-Mapped Peripherals (MMIO)<a class="headerlink" href="#sw-memory-mapped-peripherals-mmio" title="Permanent link">&para;</a></h3>
<p>All peripherals are mapped to the upper memory range starting at <code>0xFFFFxxxx</code>.</p>
<hr />
<h4 id="sw-communication-uart">Communication (UART)<a class="headerlink" href="#sw-communication-uart" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Address</th>
<th>Register Name</th>
<th>Perms</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0xFFFF0000</code></td>
<td>UART_RX_VALID</td>
<td>RO</td>
<td>Receive Status. Data is valid to read from <code>UART_RX</code> only when the LSB (Least Significant Bit) of this register is set to 1.</td>
</tr>
<tr>
<td><code>0xFFFF0004</code></td>
<td>UART_RX</td>
<td>RO</td>
<td>Receive Data. Reads input from the keyboard. Only the LSByte (lowest 8 bits) contains valid data.</td>
</tr>
<tr>
<td><code>0xFFFF0008</code></td>
<td>UART_TX_READY</td>
<td>RO</td>
<td>Transmit Status. Data is safe to write to <code>UART_TX</code> only when the LSB of this register is set to 1.</td>
</tr>
<tr>
<td><code>0xFFFF000C</code></td>
<td>UART_TX</td>
<td>WO</td>
<td>Transmit Data. Sends output to the display/console. Only the LSByte is writeable.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="sw-on-board-io-gpio">On-Board I/O (GPIO)<a class="headerlink" href="#sw-on-board-io-gpio" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Address</th>
<th>Register Name</th>
<th>Perms</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0xFFFF0060</code></td>
<td>LED</td>
<td>WO</td>
<td>LED control register</td>
</tr>
<tr>
<td><code>0xFFFF0064</code></td>
<td>DIP</td>
<td>RO</td>
<td>DIP switch input register</td>
</tr>
<tr>
<td><code>0xFFFF0068</code></td>
<td>PB</td>
<td>RO</td>
<td>Push button input register</td>
</tr>
<tr>
<td><code>0xFFFF0080</code></td>
<td>SEVENSEG</td>
<td>WO</td>
<td>7-segment display output register</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Register Details</p>
<dl>
<dt><code>LED -- 0xFFFF0060 (WO)</code></dt>
<dd>
<p>The lower <strong>8 bits</strong> are user-writeable. The upper bits are hardwired as follows:</p>
<ul>
<li><strong>[7:0]</strong> user writeable,</li>
<li><strong>[8]</strong> divided clock,</li>
<li><strong>[15:9]</strong> program counter <code>[8:2]</code>.</li>
</ul>
</dd>
<dt><code>DIP -- 0xFFFF0064 (RO)</code></dt>
<dd>
<p>Reads the state of the <strong>16 on-board switches</strong>, covering switch range <strong>SW15SW0</strong>.</p>
</dd>
<dt><code>PB -- 0xFFFF0068 (RO)</code></dt>
<dd>
<p>Only the lowest <strong>3 bits</strong> are valid.</p>
<ul>
<li><strong>[2]</strong> BTNR (Right),</li>
<li><strong>[1]</strong> BTNC (Center),</li>
<li><strong>[0]</strong> BTNL (Left).</li>
</ul>
<p>The remaining buttons are hardwired: <strong>BTND</strong> resets the system, while <strong>BTNU</strong> pauses execution.</p>
</dd>
<dt><code>SEVENSEG -- 0xFFFF0080 (WO)</code></dt>
<dd>
<p>Writes an <strong>8-digit hexadecimal number</strong> to the 7-segment display.</p>
</dd>
</dl>
</div>
<hr />
<h4 id="sw-sensor-display-modules">Sensor &amp; Display Modules<a class="headerlink" href="#sw-sensor-display-modules" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Address</th>
<th>Register Name</th>
<th>Perms</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0xFFFF0020</code></td>
<td>OLED_COL</td>
<td>WO</td>
<td>Sets the OLED pixel column index (0  95).</td>
</tr>
<tr>
<td><code>0xFFFF0024</code></td>
<td>OLED_ROW</td>
<td>WO</td>
<td>Sets the OLED pixel row index (0  63).</td>
</tr>
<tr>
<td><code>0xFFFF0028</code></td>
<td>OLED_DATA</td>
<td>WO</td>
<td>Writes data to the pixel. Format depends on <code>OLED_CTRL</code>.</td>
</tr>
<tr>
<td><code>0xFFFF002C</code></td>
<td>OLED_CTRL</td>
<td>WO</td>
<td>Controls OLED data format and operation modes.</td>
</tr>
<tr>
<td><code>0xFFFF0040</code></td>
<td>ACCEL_DATA</td>
<td>RO</td>
<td>Reads accelerometer data (refer to peripherals documentation for format).</td>
</tr>
<tr>
<td><code>0xFFFF0044</code></td>
<td>ACCEL_DREADY</td>
<td>RO</td>
<td>Data Ready. LSB is set when a new reading is available.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="sw-system-counters">System Counters<a class="headerlink" href="#sw-system-counters" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Address</th>
<th>Register Name</th>
<th>Perms</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0xFFFF00A0</code></td>
<td>CYCLECOUNT</td>
<td>RO</td>
<td>Returns the number of clock cycles elapsed since system reset.</td>
</tr>
</tbody>
</table>
<h2 id="sw-toolchain-setup">Toolchain Setup<a class="headerlink" href="#sw-toolchain-setup" title="Permanent link">&para;</a></h2>
<p>I used the RISC-V GNU Toolchain to compile C code into machine code (hex files) and then load them into the Mach-V processor's IROM (<code>AA_IROM.mem</code>) and DMEM (<code>AA_DMEM.mem</code>).</p>
<h3 id="sw-install-toolchain">Install Toolchain<a class="headerlink" href="#sw-install-toolchain" title="Permanent link">&para;</a></h3>
<p>The toolchain that I used is pre-built and can be found on <a href="https://github.com/stnolting/riscv-gcc-prebuilt">GitHub</a>. I chose the <code>rv32i-131023</code> version. The installation guide is also available on the <a href="https://github.com/stnolting/riscv-gcc-prebuilt?tab=readme-ov-file#installation">repository</a>.</p>
<h3 id="sw-build-configuration">Build Configuration<a class="headerlink" href="#sw-build-configuration" title="Permanent link">&para;</a></h3>
<p>To compile C code into hex files for IROM and DMEM, I used three files: <code>Makefile</code>, <code>ld.script</code> and <code>crt.s</code>. For every C program that is newly written, these three files need to be added and modified accordingly.</p>
<hr />
<h4 id="sw-makefile"><code>Makefile</code><a class="headerlink" href="#sw-makefile" title="Permanent link">&para;</a></h4>
<p><code>Makefile</code> defines the rules for the <code>make</code> command to work. Make sure the <code>GCC_DIR</code> is correct and feel free to change the <code>CFLAGS</code> as you wish (like changing the Optimization flag from <code>-O2</code> to <code>-O3</code> etc).</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>You can get a template from any one of the application, but I recommend the <a href="https://github.com/mendax1234/Mach-V/blob/main/sw/calculator/Makefile"><code>sw/calculator/Makefile</code></a>.</p>
</div>
<hr />
<h4 id="sw-ldscript"><code>ld.script</code><a class="headerlink" href="#sw-ldscript" title="Permanent link">&para;</a></h4>
<p><code>ld.script</code> first specifies the size left for IROM and DMEM. In the Mach-V processor,</p>
<ul>
<li><code>ROM</code> stands for IROM, its <code>ORIGIN</code> is <code>0x00400000</code>, its <code>LENGTH</code> depends on the size of the <code>code.hex</code> generated.</li>
<li><code>RAM</code> stands for DMEM, its <code>ORIGIN</code> is <code>0x10010000</code>, its <code>LENGTH</code> depends on the size of the <code>data.hex</code> generated.</li>
</ul>
<p>Secondly, it specifies which section in the compiled program goes to which memory region. This determines which part of the program is stored in IROM and which part is stored in DMEM. For example,</p>
<ul>
<li>the <code>.rodata</code> and <code>.data</code> sections are dumped into DMEM</li>
<li>the <code>.text</code> section is dumped into IROM.</li>
</ul>
<hr />
<h4 id="sw-crts"><code>crt.s</code><a class="headerlink" href="#sw-crts" title="Permanent link">&para;</a></h4>
<p>The <code>crt.s</code> file is the entry point of the software. It sets up the execution environment before handing control to the C <code>main()</code> function.</p>
<p>For each new application, the <code>li sp, &lt;address&gt;</code> instruction needs to be modified to set the stack pointer (<code>sp</code>) to the top of DMEM. The stack grows downwards from high memory to low memory. Thus you should set the stack pointer to the very end of your available DMEM.</p>
<div class="arithmatex">\[
\text{Initial SP} = \text{DMEM_BASE} + \text{DMEM_SIZE}
\]</div>
<p>For example, if your DMEM size is 7KB (the <code>sw/coremark</code> example), and the Mach-V processor's DMEM base address is <code>0x10010000</code>, then the initial stack pointer should be set to:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#sw-__codelineno-1-1"></a>li sp, 0x10011C00  # 0x10010000 + 7 * 1024
</span></code></pre></div>
<hr />
<h3 id="sw-compile-and-load">Compile and Load<a class="headerlink" href="#sw-compile-and-load" title="Permanent link">&para;</a></h3>
<p>After setting up the three files above, you can simply run the <code>make</code> command in the terminal while being in the application's directory. If everything is set up correctly, two hex files named <code>code.hex</code> and <code>data.hex</code> will be generated. Copy and paste the contents of <code>code.hex</code> into <code>AA_IROM.mem</code> and <code>data.hex</code> into <code>AA_DMEM.mem</code> in the Vivado project to load the program into the Mach-V processor.</p>
<p>To clean up the generated files, you can run <code>make clean</code>.</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Now you are ready to write, compile, and run your software on the Mach-V processor! Feel free to move on to explore the existing software applications in the <code>sw/</code> directory.</p>
</div></section><section class="print-page" id="sw-benchmark" heading-number="4.2"><h1 id="sw-benchmark-coremark-benchmark">CoreMark Benchmark<a class="headerlink" href="#sw-benchmark-coremark-benchmark" title="Permanent link">&para;</a></h1>
<p>The <a href="https://www.eembc.org/coremark/">CoreMark</a> benchmark is used to evaluate the performance of the Mach-V processor. It measures the CPU's ability to handle list processing, matrix manipulation, and state machine execution.</p>
<h2 id="sw-benchmark-source-code-organization">Source Code Organization<a class="headerlink" href="#sw-benchmark-source-code-organization" title="Permanent link">&para;</a></h2>
<p>The CoreMark source code and build scripts are located in the <code>sw/coremark/</code> directory.</p>
<h2 id="sw-benchmark-porting-implementation">Porting Implementation<a class="headerlink" href="#sw-benchmark-porting-implementation" title="Permanent link">&para;</a></h2>
<p>The CoreMark port for Mach-V is based on the barebones implementation. To adapt it for the Mach-V memory map, modifications are required in <code>sw/coremark/barebones/core_portme.c</code> and <code>sw/coremark/barebones/ee_printf.c</code>.</p>
<h3 id="sw-benchmark-system-timer">System Timer<a class="headerlink" href="#sw-benchmark-system-timer" title="Permanent link">&para;</a></h3>
<p>CoreMark requires a method to measure time to calculate the performance score. In <code>core_portme.c</code>, the <code>barebones_clock()</code> function is modified to read the Mach-V <code>CYCLECOUNT</code> system counter.</p>
<p><strong>Modification:</strong> Update <code>hardwareCounterAddr</code> to point to the Mach-V <a href="#sw-system-counters">system counter</a> address (<code>0xFFFF00A0</code>).</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#sw-benchmark-__codelineno-0-1"></a><span class="n">CORETIMETYPE</span><span class="w"> </span><span class="nf">barebones_clock</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#sw-benchmark-__codelineno-0-2"></a><span class="w">    </span><span class="c1">// Pointer to the Mach-V System Counter (CYCLECOUNT)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#sw-benchmark-__codelineno-0-3"></a><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">hardwareCounterAddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="mh">0xffff00a0</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#sw-benchmark-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#sw-benchmark-__codelineno-0-5"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hardwareCounter</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#sw-benchmark-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#sw-benchmark-__codelineno-0-7"></a><span class="w">    </span><span class="c1">// Read hardwareCounter (Execution Cycle)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#sw-benchmark-__codelineno-0-8"></a><span class="w">    </span><span class="n">hardwareCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">hardwareCounterAddr</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#sw-benchmark-__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#sw-benchmark-__codelineno-0-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">CORETIMETYPE</span><span class="p">)</span><span class="n">hardwareCounter</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#sw-benchmark-__codelineno-0-11"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="sw-benchmark-uart-output">UART Output<a class="headerlink" href="#sw-benchmark-uart-output" title="Permanent link">&para;</a></h3>
<p>To output the benchmark results to the console, the UART transmission function must be mapped to the correct MMIO addresses.</p>
<p><strong>Modification:</strong> In <code>ee_printf.c</code>, update the pointers in <code>uart_send_char()</code> to match the Mach-V UART peripheral addresses. The relevant addresses are introduced in <a href="#sw-communication-uart">System Memory Map</a>.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#sw-benchmark-__codelineno-1-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">uart_send_char</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#sw-benchmark-__codelineno-1-2"></a><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">UART_TX_READY_ADDR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="mh">0xFFFF0008</span><span class="p">;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#sw-benchmark-__codelineno-1-3"></a><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">UART_TX_ADDR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mh">0xFFFF000C</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#sw-benchmark-__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#sw-benchmark-__codelineno-1-5"></a><span class="w">    </span><span class="c1">// Wait until UART is ready (LSB == 1 indicates ready)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#sw-benchmark-__codelineno-1-6"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">UART_TX_READY_ADDR</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#sw-benchmark-__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#sw-benchmark-__codelineno-1-8"></a><span class="w">    </span><span class="c1">// Write character to the transmission buffer</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#sw-benchmark-__codelineno-1-9"></a><span class="w">    </span><span class="o">*</span><span class="n">UART_TX_ADDR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#sw-benchmark-__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#sw-benchmark-__codelineno-1-11"></a><span class="w">    </span><span class="c1">// Optional: Wait for transmission completion</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#sw-benchmark-__codelineno-1-12"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">UART_TX_READY_ADDR</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#sw-benchmark-__codelineno-1-13"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="sw-benchmark-build-configuration">Build Configuration<a class="headerlink" href="#sw-benchmark-build-configuration" title="Permanent link">&para;</a></h2>
<h3 id="sw-benchmark-setting-clock-frequency">Setting Clock Frequency<a class="headerlink" href="#sw-benchmark-setting-clock-frequency" title="Permanent link">&para;</a></h3>
<p>To ensure the CoreMark score (Iterations/Sec) is calculated correctly, the build script must know the target processor frequency.</p>
<p>Modify the <code>Makefile</code> under <code>sw/coremark</code> to set the <code>CLOCKS_PER_SEC</code> flag. This value must match the frequency of the Mach-V processor. For example, for a design running at 50 MHz:</p>
<div class="language-makefile highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#sw-benchmark-__codelineno-2-1"></a><span class="nv">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50000000</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If <code>CLOCKS_PER_SEC</code> does not match the actual hardware clock frequency, the reported CoreMark/MHz score will be mathematically incorrect.</p>
</div>
<div class="admonition success">
<p class="admonition-title">Ready to Run</p>
<p>With the porting layer configured and the frequency set, the CoreMark benchmark is ready to run on Mach-V!</p>
</div></section><section class="print-page" id="sw-uart_calculator" heading-number="4.3"><h1 id="sw-uart_calculator-uart-calculator">UART Calculator<a class="headerlink" href="#sw-uart_calculator-uart-calculator" title="Permanent link">&para;</a></h1>
<p>This is a simple calculator program that is used to test the basic functionality of the Mach-V processor. It contains all the basic instructiosn from RISC-V I and M extensions, and performs arithmetic operations based on user input via UART.</p>
<h2 id="sw-uart_calculator-source-code-organization">Source Code Organization<a class="headerlink" href="#sw-uart_calculator-source-code-organization" title="Permanent link">&para;</a></h2>
<p>The source code for the UART Calculator is located in the <code>sw/uart_calculator/</code> directory. The main source file is <code>uart_calculator.c</code>, which contains the implementation of the calculator logic and UART communication.</p>
<h2 id="sw-uart_calculator-porting-implementation">Porting Implementation<a class="headerlink" href="#sw-uart_calculator-porting-implementation" title="Permanent link">&para;</a></h2>
<h3 id="sw-uart_calculator-uart-output">UART Output<a class="headerlink" href="#sw-uart_calculator-uart-output" title="Permanent link">&para;</a></h3>
<p>As the calculator uses UART to communicate with the Mach-V processor, if the MMIO addresses are changed, the code in <code>uart_calculator.c</code> must be updated accordingly. The MMIO definitions are located at the top of the <code>uart_calculator.c</code> file,</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#sw-uart_calculator-__codelineno-0-1"></a><span class="cp">#define MMIO_BASE 0xFFFF0000</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#sw-uart_calculator-__codelineno-0-2"></a><span class="cp">#define UART_RX_VALID_OFF 0x00</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#sw-uart_calculator-__codelineno-0-3"></a><span class="cp">#define UART_RX_DATA_OFF 0x04</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#sw-uart_calculator-__codelineno-0-4"></a><span class="cp">#define UART_TX_READY_OFF 0x08</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#sw-uart_calculator-__codelineno-0-5"></a><span class="cp">#define UART_TX_DATA_OFF 0x0C</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#sw-uart_calculator-__codelineno-0-6"></a><span class="cp">#define SEVENSEG_OFF 0x80</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you are using different MMIO addresses for UART or other peripherals, make sure to update these definitions accordingly.</p>
</div>
<h3 id="sw-uart_calculator-dmem-initialization">DMEM Initialization<a class="headerlink" href="#sw-uart_calculator-dmem-initialization" title="Permanent link">&para;</a></h3>
<p>The application pre-loads data into Data Memory (DMEM) to test Load/Store instructions. This is handled via initialized global arrays in C, which the linker places in the <code>.data</code> section.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#sw-uart_calculator-__codelineno-1-1"></a><span class="c1">// Pre-loaded test patterns for Load operations</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#sw-uart_calculator-__codelineno-1-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">test_data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#sw-uart_calculator-__codelineno-1-3"></a><span class="w">    </span><span class="mh">0x12345678</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#sw-uart_calculator-__codelineno-1-4"></a><span class="w">    </span><span class="mh">0x9ABCDEF0</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#sw-uart_calculator-__codelineno-1-5"></a><span class="w">    </span><span class="mh">0xAABBCCDD</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#sw-uart_calculator-__codelineno-1-6"></a><span class="w">    </span><span class="mh">0xEEFF0011</span><span class="p">};</span>
</span></code></pre></div>
<h2 id="sw-uart_calculator-build-configuration">Build Configuration<a class="headerlink" href="#sw-uart_calculator-build-configuration" title="Permanent link">&para;</a></h2>
<p>There is nothing much to customize or change in the <code>Makefile</code>, <code>ld.script</code> and <code>crt.s</code> files for this application. This is also why this application can be regarded as a template for other new applications.</p>
<h2 id="sw-uart_calculator-application-usage">Application Usage<a class="headerlink" href="#sw-uart_calculator-application-usage" title="Permanent link">&para;</a></h2>
<p>The calculator operates using a strictly defined 9-byte communication protocol over UART.</p>
<h3 id="sw-uart_calculator-communication-protocol">Communication Protocol<a class="headerlink" href="#sw-uart_calculator-communication-protocol" title="Permanent link">&para;</a></h3>
<p>For every operation, the user must send exactly <strong>9 bytes</strong> to the processor:</p>
<ol>
<li><strong>Command 1(1 Byte)</strong>: An ASCII character selecting the operation (see table below).</li>
<li><strong>Operand 1(4 Bytes)</strong>: The first 32-bit argument, sent Big-Endian (MSB first).</li>
<li><strong>Operand 2(4 Bytes)</strong>: The second 32-bit argument, sent Big-Endian (MSB first).</li>
</ol>
<p><strong>Output</strong>: The result of the operation is written to the <strong>7-segment Display</strong> MMIO address.</p>
<h3 id="sw-uart_calculator-command-reference">Command Reference<a class="headerlink" href="#sw-uart_calculator-command-reference" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Command</th>
<th>ASCII</th>
<th>Operation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Arithmetic</strong></td>
<td>ADD</td>
<td>a</td>
<td>op1 + op2</td>
<td>32-bit Addition</td>
</tr>
<tr>
<td></td>
<td>SUB</td>
<td>s</td>
<td>op1 - op2</td>
<td>32-bit Subtraction</td>
</tr>
<tr>
<td><strong>Logical</strong></td>
<td>AND</td>
<td>c</td>
<td>op1 &amp; op2</td>
<td>Bitwise AND</td>
</tr>
<tr>
<td></td>
<td>OR</td>
<td>o</td>
<td>op1 | op2</td>
<td>Bitwise OR</td>
</tr>
<tr>
<td></td>
<td>XOR</td>
<td>x</td>
<td>op1 ^ op2</td>
<td>Bitwise XOR</td>
</tr>
<tr>
<td><strong>Shift</strong></td>
<td>SLL</td>
<td>L</td>
<td>op1 &lt;&lt; op2</td>
<td>Shift Left Logical</td>
</tr>
<tr>
<td></td>
<td>SRL</td>
<td>R</td>
<td>op1 &gt;&gt; op2</td>
<td>Shift Right Logical</td>
</tr>
<tr>
<td></td>
<td>SRA</td>
<td>A</td>
<td>op1 &gt;&gt; op2</td>
<td>Shift Right Arithmetic (sign-extended)</td>
</tr>
<tr>
<td><strong>Comparison</strong></td>
<td>SLT</td>
<td>l</td>
<td>op1 &lt; op2</td>
<td>Set if Less Than (Signed)</td>
</tr>
<tr>
<td></td>
<td>SLTU</td>
<td>u</td>
<td>op1 &lt; op2</td>
<td>Set if Less Than (Unsigned)</td>
</tr>
<tr>
<td><strong>Multiply / Div</strong></td>
<td>MUL</td>
<td>m</td>
<td>op1 * op2</td>
<td>Low 32 bits of product</td>
</tr>
<tr>
<td></td>
<td>MULH</td>
<td>H</td>
<td>op1 * op2</td>
<td>High 32 bits (Signed)</td>
</tr>
<tr>
<td></td>
<td>MULHU</td>
<td>h</td>
<td>op1 * op2</td>
<td>High 32 bits (Unsigned)</td>
</tr>
<tr>
<td></td>
<td>DIV</td>
<td>d</td>
<td>op1 / op2</td>
<td>Signed Division</td>
</tr>
<tr>
<td></td>
<td>DIVU</td>
<td>D</td>
<td>op1 / op2</td>
<td>Unsigned Division</td>
</tr>
<tr>
<td></td>
<td>REM</td>
<td>r</td>
<td>op1 % op2</td>
<td>Signed Remainder</td>
</tr>
<tr>
<td></td>
<td>REMU</td>
<td>M</td>
<td>op1 % op2</td>
<td>Unsigned Remainder</td>
</tr>
<tr>
<td><strong>Memory Access</strong></td>
<td>LOAD</td>
<td>1..4</td>
<td>Mem[op1]</td>
<td>Reads from <code>test_data</code>. 1=LB, 2=LBU, 3=LH, 4=LHU</td>
</tr>
<tr>
<td></td>
<td>STORE</td>
<td>5..6</td>
<td>Mem[op1] = op2</td>
<td>Writes to <code>scratch_mem</code>. 5=SB, 6=SH</td>
</tr>
</tbody>
</table></section><section class="print-page" id="sw-resources" heading-number="4.4"><h1 id="sw-resources-resoures-utilities">Resoures &amp; Utilities<a class="headerlink" href="#sw-resources-resoures-utilities" title="Permanent link">&para;</a></h1>
<p>This section contains utility guides and extra information regarding the Mach-V software stack.</p>
<h2 id="sw-resources-offline-access">Offline Access<a class="headerlink" href="#sw-resources-offline-access" title="Permanent link">&para;</a></h2>
<p>This documentation supports exporting the entire site as a single, consolidated PDF for offline reading. This is powered by the <a href="https://timvink.github.io/mkdocs-print-site-plugin/index.html"><code>mkdocs-print-site-plugin</code></a>.</p>
<h3 id="sw-resources-export-to-pdf">Export to PDF<a class="headerlink" href="#sw-resources-export-to-pdf" title="Permanent link">&para;</a></h3>
<p>Currently, there is no direct download button in the navigation bar. You can generate the PDF manually by following these steps:</p>
<ol>
<li>Access the Print View: Navigate to the consolidated print view by appending <code>print_page/</code> to the base URL of the documentation. For example, go to <code>https://mendax1234.github.io/Mach-V/print_page/</code>.</li>
<li>Print to PDF: Once the page loads (it may take a moment to render all chapters):<ol>
<li>Open your browser's print dialog (<code>Ctrl + P</code> on Windows/Linux or <code>Cmd + P</code> on macOS).</li>
<li>Set the <strong>Destination</strong> to <strong>"Save as PDF"</strong>.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Formatting</p>
<p>For the best layout, ensure <strong>Background graphics</strong> is checked in your browser's print settings to preserve syntax highlighting and admonition colors.</p>
</div>
<h2 id="sw-resources-useful-links">Useful Links<a class="headerlink" href="#sw-resources-useful-links" title="Permanent link">&para;</a></h2>
<p>The success of Mach-V cannot be achieved without the help of many open-source projects and resources. Here are some useful links that you may find helpful when working with Mach-V:</p>
<div class="grid cards">
<ul>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41s-1.03.39-1.42.01A9.97 9.97 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13"/></svg></span> <strong>CoreMark Benchmark</strong></p>
<hr />
<p>Official CoreMark benchmark by EEMBC, widely used to evaluate embedded
processor performance.</p>
<p><a href="https://www.eembc.org/coremark/"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Visit EEMBC</a></p>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 4h12v1h3v2h-3v2h3v2h-3v2h3v2h-3v2h3v2h-3v1H6v-1H3v-2h3v-2H3v-2h3v-2H3V9h3V7H3V5h3zm5 11v3h1v-3zm2 0v3h1v-3zm2 0v3h1v-3z"/></svg></span> <strong>CoreMark on Bare-Metal Systems</strong></p>
<hr />
<p>CoreMark running on bare-bone RISC-V systems, including build scripts
and platform-specific adaptations.</p>
<p><a href="https://github.com/yutyan0119/rv32I-TangNano9K/tree/main/Coremark"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> View on GitHub</a></p>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.71 20.29-1.42 1.42a1 1 0 0 1-1.41 0L7 9.85A3.8 3.8 0 0 1 6 10a4 4 0 0 1-3.78-5.3l2.54 2.54.53-.53 1.42-1.42.53-.53L4.7 2.22A4 4 0 0 1 10 6a3.8 3.8 0 0 1-.15 1l11.86 11.88a1 1 0 0 1 0 1.41M2.29 18.88a1 1 0 0 0 0 1.41l1.42 1.42a1 1 0 0 0 1.41 0l5.47-5.46-2.83-2.83M20 2l-4 2v2l-2.17 2.17 2 2L18 8h2l2-4Z"/></svg></span> <strong>Pre-built RISC-V GNU Toolchain</strong></p>
<hr />
<p>Pre-compiled RISC-V GCC toolchain for rapid development without
building from source.</p>
<p><a href="https://github.com/stnolting/riscv-gcc-prebuilt"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Download Toolchain</a></p>
</li>
</ul>
</div></section>
                    <section class='print-page md-section' id='section-4-5' heading-number='4.5'>
                        <h1>Changelog<a class='headerlink' href='#section-4-5' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="sw-changelog" heading-number="4.5.1"><h1 id="sw-changelog-changelog">Changelog<a class="headerlink" href="#sw-changelog-changelog" title="Permanent link">&para;</a></h1>
<h2 id="sw-changelog-mach-v-processor">Mach-V Processor<a class="headerlink" href="#sw-changelog-mach-v-processor" title="Permanent link">&para;</a></h2>
<h3 id="sw-changelog-2.0">2.0<a class="headerlink" href="#sw-changelog-2.0" title="Permanent link">&para;</a></h3>
<p><strong>Focus:</strong> Timing optimization and hardware acceleration.</p>
<ul>
<li><strong>Enhanced Clock Frequency:</strong> Integrated Clock Wizard to boost operating frequency to <strong>115 MHz</strong> (from 100 MHz baseline).</li>
<li><strong>Critical Path Optimization:</strong> Relocated PC logic from the Execute (EXE) stage to the Memory (MEM) stage to relax timing constraints.</li>
<li><strong>Hardware-Accelerated Arithmetic:</strong> Replaced native multiplier/divider designs with optimized AMD/Xilinx IP cores for high-performance integer arithmetic.</li>
</ul>
<h3 id="sw-changelog-1.0">1.0<a class="headerlink" href="#sw-changelog-1.0" title="Permanent link">&para;</a></h3>
<p><strong>Focus:</strong> Baseline implementation featuring a classic RISC-V scalar architecture.</p>
<ul>
<li><strong>Classic 5-Stage Pipeline:</strong> Implemented standard Fetch, Decode, Execute, Memory, and Writeback stages.</li>
<li><strong>Comprehensive Hazard Management:</strong> Added dedicated hardware for data forwarding and hazard detection to resolve data/control hazards.</li>
<li><strong>Scalar In-Order Execution:</strong> Established single-issue sequential execution ensuring deterministic behavior and architectural simplicity.</li>
</ul></section><section class="print-page" id="sw-changelog-conventions" heading-number="4.5.2"><h1 id="sw-changelog-conventions-conventions">Conventions<a class="headerlink" href="#sw-changelog-conventions-conventions" title="Permanent link">&para;</a></h1>
<p>This section explains the symbols and conventions used throughout the Mach-V documentation.</p>
<h2 id="sw-changelog-conventions-symbols">Symbols<a class="headerlink" href="#sw-changelog-conventions-symbols" title="Permanent link">&para;</a></h2>
<p>The documentation uses visual badges to denote specific hardware states, version requirements, or configuration settings. Please familiarize yourself with the following conventions:</p>
<h3 id="sw-changelog-conventions-version"><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-version" title="Minimum version"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></a></span></span>  Version<a class="headerlink" href="#sw-changelog-conventions-version" title="Permanent link">&para;</a></h3>
<p>The tag symbol denotes the <strong>Mach-V Core Version</strong> required for a specific feature or architectural change. Ensure your hardware description (RTL) matches this version tag to guarantee compatibility.</p>
<h3 id="sw-changelog-conventions-feature"><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-feature" title="Optional feature"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg></span></a></span></span>  Optional Feature<a class="headerlink" href="#sw-changelog-conventions-feature" title="Permanent link">&para;</a></h3>
<p>This symbol indicates a hardware module (such as the Branch Predictor or FPU) that is not included in the core by default. These features must be explicitly enabled via Verilog defines (e.g., <code>`define ENABLE_FPU</code>) in your configuration file.</p>
<h3 id="sw-changelog-conventions-plugin"><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-plugin" title="External IP / Plugin"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5.5L18.5 3H17v6a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V3zm7 1v5h3V4zm-5 8h10a1 1 0 0 1 1 1v6H6v-6a1 1 0 0 1 1-1"/></svg></span></a></span></span>  External IP / Plugin<a class="headerlink" href="#sw-changelog-conventions-plugin" title="Permanent link">&para;</a></h3>
<p>This symbol refers to <strong>External IP Cores</strong> (like Xilinx Clock Wizards or AMD Multipliers) or software plugins used in the project. These components may require specific vendor licenses or additional synthesis libraries.</p>
<h3 id="sw-changelog-conventions-experimental"><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-experimental" title="Experimental"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 19a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1c0-.21-.07-.41-.18-.57L13 8.35V4h-2v4.35L5.18 18.43c-.11.16-.18.36-.18.57m1 3a3 3 0 0 1-3-3c0-.6.18-1.16.5-1.63L9 7.81V6a1 1 0 0 1-1-1V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v1a1 1 0 0 1-1 1v1.81l5.5 9.56c.32.47.5 1.03.5 1.63a3 3 0 0 1-3 3zm7-6 1.34-1.34L16.27 18H7.73l2.66-4.61zm-.5-4a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5"/></svg></span></a></span></span>  Experimental<a class="headerlink" href="#sw-changelog-conventions-experimental" title="Permanent link">&para;</a></h3>
<p>Features marked with the flask symbol are currently being tested on the FPGA and may be unstable. The timing closure or logic correctness for these features is not yet guaranteed in all corner cases.</p>
<h3 id="sw-changelog-conventions-default"><span class="mdx-badge"><span class="mdx-badge__icon"><a href="#sw-changelog-conventions-default" title="Default value"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a6 6 0 0 1-6-6c0-4 6-10.75 6-10.75S18 10 18 14a6 6 0 0 1-6 6"/></svg></span></a></span></span>  Default Value<a class="headerlink" href="#sw-changelog-conventions-default" title="Permanent link">&para;</a></h3>
<p>Indicates the <strong>default reset value</strong> of a hardware register or a configuration parameter if not otherwise specified by the software bootloader.</p></section></section></section></div><style>.print-site-enumerate-headings #index > h1:before { content: '1 ' }

                .print-site-enumerate-headings #index h2:before { content: '1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-reset: counter-index-3 ;  counter-increment: counter-index-2 }
            
                .print-site-enumerate-headings #index h3:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) ' ' }
                .print-site-enumerate-headings #index h3 {  counter-increment: counter-index-3 }
            
.print-site-enumerate-headings #section-2 > h1:before { content: '2 ' }
.print-site-enumerate-headings #uarch > h1:before { content: '2.1 ' }

                .print-site-enumerate-headings #uarch h2:before { content: '2.1.' counter(counter-uarch-2) ' ' }
                .print-site-enumerate-headings #uarch h2 {  counter-increment: counter-uarch-2 }
            
.print-site-enumerate-headings #uarch-clock > h1:before { content: '2.2 ' }

                .print-site-enumerate-headings #uarch-clock h2:before { content: '2.2.' counter(counter-uarch-clock-2) ' ' }
                .print-site-enumerate-headings #uarch-clock h2 {  counter-increment: counter-uarch-clock-2 }
            
.print-site-enumerate-headings #uarch-pc-unit > h1:before { content: '2.3 ' }

                .print-site-enumerate-headings #uarch-pc-unit h2:before { content: '2.3.' counter(counter-uarch-pc-unit-2) ' ' }
                .print-site-enumerate-headings #uarch-pc-unit h2 {  counter-increment: counter-uarch-pc-unit-2 }
            
.print-site-enumerate-headings #uarch-alu > h1:before { content: '2.4 ' }

                .print-site-enumerate-headings #uarch-alu h2:before { content: '2.4.' counter(counter-uarch-alu-2) ' ' }
                .print-site-enumerate-headings #uarch-alu h2 {  counter-increment: counter-uarch-alu-2 }
            
.print-site-enumerate-headings #uarch-mul-div-unit > h1:before { content: '2.5 ' }

                .print-site-enumerate-headings #uarch-mul-div-unit h2:before { content: '2.5.' counter(counter-uarch-mul-div-unit-2) ' ' }
                .print-site-enumerate-headings #uarch-mul-div-unit h2 {  counter-increment: counter-uarch-mul-div-unit-2 }
            
.print-site-enumerate-headings #uarch-lsu > h1:before { content: '2.6 ' }

                .print-site-enumerate-headings #uarch-lsu h2:before { content: '2.6.' counter(counter-uarch-lsu-2) ' ' }
                .print-site-enumerate-headings #uarch-lsu h2 {  counter-increment: counter-uarch-lsu-2 }
            
.print-site-enumerate-headings #uarch-hazard-unit > h1:before { content: '2.7 ' }

                .print-site-enumerate-headings #uarch-hazard-unit h2:before { content: '2.7.' counter(counter-uarch-hazard-unit-2) ' ' }
                .print-site-enumerate-headings #uarch-hazard-unit h2 {  counter-increment: counter-uarch-hazard-unit-2 }
            
.print-site-enumerate-headings #section-3 > h1:before { content: '3 ' }
.print-site-enumerate-headings #sim > h1:before { content: '3.1 ' }

                .print-site-enumerate-headings #sim h2:before { content: '3.1.' counter(counter-sim-2) ' ' }
                .print-site-enumerate-headings #sim h2 {  counter-increment: counter-sim-2 }
            
.print-site-enumerate-headings #sim-benchmark_tb > h1:before { content: '3.2 ' }

                .print-site-enumerate-headings #sim-benchmark_tb h2:before { content: '3.2.' counter(counter-sim-benchmark_tb-2) ' ' }
                .print-site-enumerate-headings #sim-benchmark_tb h2 {  counter-increment: counter-sim-benchmark_tb-2 }
            
.print-site-enumerate-headings #sim-uart_tb > h1:before { content: '3.3 ' }

                .print-site-enumerate-headings #sim-uart_tb h2:before { content: '3.3.' counter(counter-sim-uart_tb-2) ' ' }
                .print-site-enumerate-headings #sim-uart_tb h2 {  counter-increment: counter-sim-uart_tb-2 }
            
.print-site-enumerate-headings #section-4 > h1:before { content: '4 ' }
.print-site-enumerate-headings #sw > h1:before { content: '4.1 ' }

                .print-site-enumerate-headings #sw h2:before { content: '4.1.' counter(counter-sw-2) ' ' }
                .print-site-enumerate-headings #sw h2 {  counter-increment: counter-sw-2 }
            
.print-site-enumerate-headings #sw-benchmark > h1:before { content: '4.2 ' }

                .print-site-enumerate-headings #sw-benchmark h2:before { content: '4.2.' counter(counter-sw-benchmark-2) ' ' }
                .print-site-enumerate-headings #sw-benchmark h2 {  counter-increment: counter-sw-benchmark-2 }
            
.print-site-enumerate-headings #sw-uart_calculator > h1:before { content: '4.3 ' }

                .print-site-enumerate-headings #sw-uart_calculator h2:before { content: '4.3.' counter(counter-sw-uart_calculator-2) ' ' }
                .print-site-enumerate-headings #sw-uart_calculator h2 {  counter-increment: counter-sw-uart_calculator-2 }
            
.print-site-enumerate-headings #sw-resources > h1:before { content: '4.4 ' }

                .print-site-enumerate-headings #sw-resources h2:before { content: '4.4.' counter(counter-sw-resources-2) ' ' }
                .print-site-enumerate-headings #sw-resources h2 {  counter-increment: counter-sw-resources-2 }
            
.print-site-enumerate-headings #section-4-5 > h1:before { content: '4.5 ' }
.print-site-enumerate-headings #sw-changelog > h1:before { content: '4.5.1 ' }

.print-site-enumerate-headings #sw-changelog-conventions > h1:before { content: '4.5.2 ' }
</style>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "/Mach-V/", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.footer", "navigation.path", "navigation.indexes", "navigation.instant", "navigation.instant.preview", "content.code.copy", "content.action.edit", "content.tooltips"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/timeago.min.js"></script>
      
        <script src="../js/timeago_mkdocs_material.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>